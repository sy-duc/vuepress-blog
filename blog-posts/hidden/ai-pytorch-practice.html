<!doctype html>
<html lang="vi-VN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/vuepress-blog/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,400,500,600,700&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><title>Th·ª±c h√†nh Deep Learning v·ªõi PyTorch | Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám</title><meta name="description" content="M·ªôt blog ƒë∆∞·ª£c t·∫°o b·∫±ng VuePress">
    <link rel="preload" href="/vuepress-blog/assets/style-B07U0idc.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-B07U0idc.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-H7UPTZlK.js"><link rel="modulepreload" href="/vuepress-blog/assets/ai-pytorch-practice.html-S9bvq2K2.js"><link rel="modulepreload" href="/vuepress-blog/assets/ai-pytorch-CX6UVv0D.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-C9BH5l_7.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-b4OZyCpW.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-k9U0GFHk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-C2WEWtEP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-BrID5FHT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/fastapi-base-project.html-CNpJm-6Y.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/mov-to-mp4-converter.html-CZaHSPVb.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-series.html-Cnwu3MzA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tesseract-series.html-CVP5cOAF.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/plsql-training-series.html-D-H0C4dP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-advanced.html-_FA5QyXu.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-basic.html-Bh4AFO2x.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-training-saa-series.html-Bd75NMd2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/jenkins.html-DVFk3kRL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-series.html-3Q-08wzm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-chatbot-practice.html-C6MVZ1d2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-deep-learning-and-neural-networks.html-SM3F92Tt.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-engineer-mindset.html-DHBZNdI3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-llm.html-BTNr6Tja.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-nen-tang.html-DBOeDUX0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-pytorch.html-93wND1Ni.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-automation.html-VrY3j3we.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-cloud-computing.html-udZgj5b6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-database.html-Bo6n1Tg5.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-ec2.html-BqGXuNnj.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-gioi-thieu-aws.html-CY8moWle.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-iam.html-SazLRiJq.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-monitoring.html-VEiA-6_o.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-networking.html-DLKSTRNo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-practice.html-C0KacuAl.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-serverless.html-gNodHLi8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-storage.html-CvYiWW42.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-beginner.html-DiTUT7D3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-intermediate.html-SQmckOVA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-shell-script.html-CGMFc8KI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-accuracy-perfomance.html-R44HpVnl.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-cache-tesseract.html-B7xUWwRc.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-gioi-thieu-tesseract.html-DdMSkOyM.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-practical.html-BW7L9Kxy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-template-matching.html-CnMtQvJo.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tong-quan.html-D0du4sRT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-training-tesseract.html-BiNfasIH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-advanced.html-Doh32Se6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-beginner.html-eSckt1Vy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-expert.html-BbgbUlgK.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-intermediate.html-DwHk9_u2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/git-practices.html-CHJOXzig.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DFe47jGY.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-B-tMgkh0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CGPAOH_0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-CGiMU5gU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-Ciz2NtwU.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><img class="vp-site-logo" src="/vuepress-blog/images/logo.png" alt="Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Ch·ªß"><!---->Trang Ch·ªß<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="D·ª± √Ån"><!---->D·ª± √Ån<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="V·ªÅ T√¥i"><!---->V·ªÅ T√¥i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/hidden/ai-pytorch-practice.html" aria-label="Ti·∫øng Vi·ªát"><!---->Ti·∫øng Vi·ªát<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Ch·ªß"><!---->Trang Ch·ªß<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="D·ª± √Ån"><!---->D·ª± √Ån<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="V·ªÅ T√¥i"><!---->V·ªÅ T√¥i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/hidden/ai-pytorch-practice.html" aria-label="Ti·∫øng Vi·ªát"><!---->Ti·∫øng Vi·ªát<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="thuc-hanh-deep-learning-voi-pytorch" tabindex="-1"><a class="header-anchor" href="#thuc-hanh-deep-learning-voi-pytorch"><span>Th·ª±c h√†nh Deep Learning v·ªõi PyTorch</span></a></h1><p><img src="/vuepress-blog/assets/ai-pytorch-BDTWWpwo.png" alt="PyTorch"></p><p>Sau khi t√¨m hi·ªÉu l√Ω thuy·∫øt n·ªÅn t·∫£ng AI v√† PyTorch, b∆∞·ªõc ti·∫øp theo l√† l√†m b√†i to√°n ·ª©ng d·ª•ng th·ª±c t·∫ø.</p><p>Tuy nhi√™n, ch√∫ng ta v·∫´n s·∫Ω gi·ªØ ƒë√∫ng h∆∞·ªõng ƒëi ban ƒë·∫ßu l√† kh√¥ng thu·∫ßn nghi√™n c·ª©u, m√† l√† x√¢y h·ªá th·ªëng AI d√πng ƒë∆∞·ª£c.</p><p><a href="#1">1. Setup m√¥i tr∆∞·ªùng PyTorch</a></p><p><a href="#2">2. B√†i to√°n D·ª± ƒëo√°n gi√° nh√†</a></p><p><a href="#3">3. B√†i to√°n Giao d·ªãch b√¨nh th∆∞·ªùng / b·∫•t th∆∞·ªùng</a></p><p><a name="1"></a></p><h2 id="üìå-1-setup-moi-truong-pytorch" tabindex="-1"><a class="header-anchor" href="#üìå-1-setup-moi-truong-pytorch"><span>üìå 1. Setup m√¥i tr∆∞·ªùng PyTorch</span></a></h2><ul><li><p>‚ùå D√πng Google Colab hay Jupyter local ch·ªâ ph√π h·ª£p cho l√∫c h·ªçc PyTorch, test, demo &amp; research, hay khi c·∫ßn GPU t·∫°m m√† m√°y local kh√¥ng c√≥.</p></li><li><p>‚úîÔ∏è Recommend m·ªçi ng∆∞·ªùi d√πng VS Code + venv (m√¥i tr∆∞·ªùng ·∫£o) lu√¥n b·ªüi:</p><ul><li>‚úß Gi·ªëng m√¥i tr∆∞·ªùng th·ª±c t·∫ø</li><li>‚úß D·ªÖ deploy</li><li>‚úß D·ªÖ ƒë√≥ng g√≥i .exe</li><li>‚úß D·ªÖ debug</li><li>‚úß Qu·∫£n l√Ω code r√µ r√†ng</li></ul></li></ul><h3 id="‚öôÔ∏è-setup" tabindex="-1"><a class="header-anchor" href="#‚öôÔ∏è-setup"><span>‚öôÔ∏è Setup</span></a></h3><ul><li><p>‚ù∂ C√†i Python ch√≠nh th·ª©c</p></li><li><p>‚ù∑ T·∫°o folder project</p></li><li><p>‚ù∏ T·∫°o m√¥i tr∆∞·ªùng ·∫£o</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">python <span class="token parameter variable">-m</span> venv venv</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>‚ùπ Active m√¥i tr∆∞·ªùng ·∫£o</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>‚ù∫ C√†i PyTorch</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pip <span class="token function">install</span> torch torchvision torchaudio</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>·ªû ƒë√¢y ch√∫ng ta d√πng CPU l√† ƒë·ªß, ch∆∞a c·∫ßn GPU.</li></ul></li><li><p>‚ùª VS Code setup</p><ul><li>‚úß M·ªü project tr√™n VS Code</li><li>‚úß Ch·ªçn Python Interpreter ‚Üí venv</li><li>‚úß C√†i extension: Python, Pylance</li></ul></li></ul><p><a name="2"></a></p><h2 id="üìå-2-bai-toan-ai-du-ƒëoan-ƒëon-gian-linear-regression" tabindex="-1"><a class="header-anchor" href="#üìå-2-bai-toan-ai-du-ƒëoan-ƒëon-gian-linear-regression"><span>üìå 2. B√†i to√°n AI d·ª± ƒëo√°n ƒë∆°n gi·∫£n (Linear Regression)</span></a></h2><ul><li>B√†i to√°n kinh ƒëi·ªÉn: D·ª± ƒëo√°n gi√° nh√†</li></ul><h3 id="_1Ô∏è‚É£-phan-tich-bai-toan" tabindex="-1"><a class="header-anchor" href="#_1Ô∏è‚É£-phan-tich-bai-toan"><span>1Ô∏è‚É£ Ph√¢n t√≠ch b√†i to√°n</span></a></h3><ul><li><p>Input: ƒë·∫∑c tr∆∞ng ng√¥i nh√†</p></li><li><p>Output: gi√° nh√† (s·ªë th·ª±c)</p></li><li><p>üëâ AI s·∫Ω ph·∫£i h·ªçc xu h∆∞·ªõng t·ª´ d·ªØ li·ªáu:</p><ul><li><strong>‚ÄúV·ªõi c√°c ƒë·∫∑c tr∆∞ng n√†y, gi√° th∆∞·ªùng n·∫±m ·ªü kho·∫£ng n√†o?‚Äù</strong></li></ul></li></ul><h3 id="_2Ô∏è‚É£-du-lieu-gia-lap" tabindex="-1"><a class="header-anchor" href="#_2Ô∏è‚É£-du-lieu-gia-lap"><span>2Ô∏è‚É£ D·ªØ li·ªáu gi·∫£ l·∫≠p</span></a></h3><ul><li><p>Ch√∫ng ta t·∫°o dataset ƒë∆°n gi·∫£n nh∆∞ng th·ª±c t·∫ø:</p><table><thead><tr><th>Feature</th><th>√ù nghƒ©a</th></tr></thead><tbody><tr><td>area</td><td>Di·ªán t√≠ch (m¬≤)</td></tr><tr><td>bedrooms</td><td>S·ªë ph√≤ng</td></tr><tr><td>distance</td><td>Kho·∫£ng c√°ch t·ªõi trung t√¢m (km)</td></tr></tbody></table><ul><li>üëâ 3 feature ‚Üí 1 gi√°</li></ul></li></ul><h3 id="_3Ô∏è‚É£-structure-project" tabindex="-1"><a class="header-anchor" href="#_3Ô∏è‚É£-structure-project"><span>3Ô∏è‚É£ Structure project</span></a></h3><ul><li><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">house_price/</span>
<span class="line">‚îÇ</span>
<span class="line">‚îú‚îÄ venv/</span>
<span class="line">‚îú‚îÄ data.py          # D·ªØ li·ªáu</span>
<span class="line">‚îú‚îÄ model.py         # ƒê·ªãnh nghƒ©a Model</span>
<span class="line">‚îú‚îÄ train.py         # H·ªçc</span>
<span class="line">‚îú‚îÄ predict.py       # D·ª± ƒëo√°n</span>
<span class="line">‚îî‚îÄ requirements.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Tham kh·∫£o source <a href="https://github.com/sy-duc/house_price_ai" target="_blank" rel="noopener noreferrer">t·∫°i ƒë√¢y</a>.</p></li></ul><h3 id="_4Ô∏è‚É£-import-tao-du-lieu" tabindex="-1"><a class="header-anchor" href="#_4Ô∏è‚É£-import-tao-du-lieu"><span>4Ô∏è‚É£ Import &amp; t·∫°o d·ªØ li·ªáu</span></a></h3><h4 id="‚ù∂-tao-du-lieu" tabindex="-1"><a class="header-anchor" href="#‚ù∂-tao-du-lieu"><span>‚ù∂ T·∫°o d·ªØ li·ªáu</span></a></h4><ul><li><p>ƒê·ªÉ hi·ªÉu PyTorch, ch√∫ng ta th∆∞·ªùng s·∫Ω t·∫°o d·ªØ li·ªáu gi·∫£ l·∫≠p ƒë·ªÉ d·ªÖ ki·ªÉm so√°t ho√†n to√†n logic, tr√°nh r·ªëi b·ªüi preprocessing s·ªõm.</p><ul><li>üëâ Khi hi·ªÉu r·ªìi s·∫Ω thay b·∫±ng d·ªØ li·ªáu th·∫≠t (CSV, DB, API).</li></ul></li><li><p><code>data.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">generate_house_data</span><span class="token punctuation">(</span>num_samples<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    T·∫°o d·ªØ li·ªáu gi·∫£ l·∫≠p cho b√†i to√°n d·ª± ƒëo√°n gi√° nh√†</span>
<span class="line">    G·ªìm 1000 m·∫´u d·ªØ li·ªáu</span>
<span class="line">    Trong th·ª±c t·∫ø, h√†m n√†y s·∫Ω l√† load CSV / query DB / call API</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Gi·ªØ cho d·ªØ li·ªáu random lu√¥n gi·ªëng nhau m·ªói l·∫ßn ch·∫°y code</span></span>
<span class="line">    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 42 kh√¥ng c√≥ √Ω nghƒ©a k·ªπ thu·∫≠t ƒë·∫∑c bi·ªát ‚Äî n√≥ l√† m·ªôt ‚Äúcon s·ªë truy·ªÅn th·ªëng‚Äù trong gi·ªõi l·∫≠p tr√¨nh</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Di·ªán t√≠ch (m¬≤): s·ªë th·ª±c t·ª´ 30 -&gt; 200</span></span>
<span class="line">    area <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> num_samples<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># S·ªë ph√≤ng ng·ªß: s·ªë nguy√™n t·ª´ 1 -&gt; 5</span></span>
<span class="line">    bedrooms <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> num_samples<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Kho·∫£ng c√°ch t·ªõi trung t√¢m (km): s·ªë th·ª±c t·ª´ 1 -&gt; 20</span></span>
<span class="line">    distance <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> num_samples<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># C√¥ng th·ª©c gi√° (ch·ªâ gi·∫£ ƒë·ªãnh ƒë·ªÉ t·∫°o d·ªØ li·ªáu, AI kh√¥ng bi·∫øt c√¥ng th·ª©c n√†y)</span></span>
<span class="line">    price <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">        area <span class="token operator">*</span> <span class="token number">5000</span>                               <span class="token comment"># Nh√† to ‚Üí gi√° cao</span></span>
<span class="line">        <span class="token operator">+</span> bedrooms <span class="token operator">*</span> <span class="token number">100000</span>                       <span class="token comment"># Nhi·ªÅu ph√≤ng ‚Üí ƒë·∫Øt</span></span>
<span class="line">        <span class="token operator">-</span> distance <span class="token operator">*</span> <span class="token number">30000</span>                        <span class="token comment"># Xa trung t√¢m ‚Üí r·∫ª</span></span>
<span class="line">        <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">,</span> num_samples<span class="token punctuation">)</span> <span class="token comment"># Noise (b·ªüi th·ª±c t·∫ø s·∫Ω kh√¥ng ho√†n h·∫£o. Kh√¥ng c√≥ noise ‚Üí model h·ªçc qu√° d·ªÖ, kh√¥ng th·ª±c t·∫ø)</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Gom feature th√†nh ma tr·∫≠n X - d·∫°ng AI c√≥ th·ªÉ d√πng do AI kh√¥ng hi·ªÉu bi·∫øn r·ªùi r·∫°c</span></span>
<span class="line">    X <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> bedrooms<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># M·ªói d√≤ng = 1 cƒÉn nh√†</span></span>
<span class="line">    y <span class="token operator">=</span> price <span class="token comment"># Nh√£n (gi√° nh√†)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> X<span class="token punctuation">,</span> y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∑-chuan-hoa-du-lieu-normalize" tabindex="-1"><a class="header-anchor" href="#‚ù∑-chuan-hoa-du-lieu-normalize"><span>‚ù∑ Chu·∫©n h√≥a d·ªØ li·ªáu (Normalize)</span></a></h4><ul><li><p>T∆∞∆°ng ƒë∆∞∆°ng b∆∞·ªõc ti·ªÅn x·ª≠ l√Ω (preprocessing).</p></li><li><p>V√≠ d·ª•:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Area (m¬≤):      [50, 120, 200]</span>
<span class="line">Bedrooms:      [1, 3, 5]</span>
<span class="line">Distance (km): [2, 10, 18]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>üëâ Scale kh√°c nhau r·∫•t l·ªõn, Gradient h·ªçc: <ul><li>‚úß Area √°p ƒë·∫£o</li><li>‚úß Bedrooms g·∫ßn nh∆∞ b·ªã ‚Äúb·ªè qua‚Äù</li></ul></li></ul></li><li><p>‚úîÔ∏è Normalize = ƒë∆∞a v·ªÅ c√πng thang ƒëo:</p><table><thead><tr><th>Feature</th><th>Tr∆∞·ªõc</th><th>Sau</th></tr></thead><tbody><tr><td>Area</td><td>50 ‚Üí 200</td><td>-1.19 ‚Üí 1.25</td></tr><tr><td>Bedrooms</td><td>1 ‚Üí 5</td><td>-1.22 ‚Üí 1.22</td></tr><tr><td>Distance</td><td>2 ‚Üí 18</td><td>-1.15 ‚Üí 1.15</td></tr></tbody></table><ul><li>üëâ Model h·ªçc c√¥ng b·∫±ng h∆°n.</li></ul></li><li><p>‚ö†Ô∏è C·∫ßn chu·∫©n h√≥a d·ªØ li·ªáu cho c·∫£ input v√† output (price).</p></li><li><p><code>data.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">normalize_features</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    mean <span class="token operator">=</span> X<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># T√≠nh trung b√¨nh</span></span>
<span class="line">    std <span class="token operator">=</span> X<span class="token punctuation">.</span>std<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>   <span class="token comment"># T√≠nh ƒë·ªô l·ªách chu·∫©n (c√°c gi√° tr·ªã c√°ch xa trung b√¨nh bao nhi√™u)</span></span>
<span class="line"></span>
<span class="line">    X_norm <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> std</span>
<span class="line">    <span class="token keyword">return</span> X_norm<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">normalize_target</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    mean <span class="token operator">=</span> y<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    std <span class="token operator">=</span> y<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    y_norm <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> std</span>
<span class="line">    <span class="token keyword">return</span> y_norm<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∏-tao-dataset" tabindex="-1"><a class="header-anchor" href="#‚ù∏-tao-dataset"><span>‚ù∏ T·∫°o Dataset</span></a></h4><ul><li><p><code>data.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">HousePriceDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>  <span class="token comment"># Chuy·ªÉn numpy ‚Üí torch.Tensor</span></span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># view(-1, 1) ƒë·ªÉ ƒë·∫£m b·∫£o shape label kh·ªõp output, tr√°nh l·ªói</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>X<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">[</span>idx<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_5Ô∏è‚É£-ƒëinh-nghia-model" tabindex="-1"><a class="header-anchor" href="#_5Ô∏è‚É£-ƒëinh-nghia-model"><span>5Ô∏è‚É£ ƒê·ªãnh nghƒ©a Model</span></a></h3><ul><li><p>Ch√∫ng ta c·∫ßn k·∫ø th·ª´a <code>nn.Module</code> ƒë·ªÉ PyTorch coi ƒë√¢y l√† model.</p></li><li><p><code>model.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn  <span class="token comment"># Neural Network module</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">HousePriceModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># input_dim - s·ªë feature ƒë·∫ßu v√†o (trong b√†i to√°n n√†y l√† 3 - area, bedrooms, distance)</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># Neural Network v·ªõi 1 layer (Linear Regression)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_6Ô∏è‚É£-training-loop" tabindex="-1"><a class="header-anchor" href="#_6Ô∏è‚É£-training-loop"><span>6Ô∏è‚É£ Training Loop</span></a></h3><ul><li>ƒê√¢y l√† n∆°i AI &quot;h·ªçc&quot;.</li></ul><h4 id="‚ù∂-chuan-bi-du-lieu" tabindex="-1"><a class="header-anchor" href="#‚ù∂-chuan-bi-du-lieu"><span>‚ù∂ Chu·∫©n b·ªã d·ªØ li·ªáu</span></a></h4><ul><li><p><code>train.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Chu·∫©n b·ªã d·ªØ li·ªáu</span></span>
<span class="line">X<span class="token punctuation">,</span> y <span class="token operator">=</span> generate_house_data<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">X_norm<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std <span class="token operator">=</span> normalize_features<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line">y_norm<span class="token punctuation">,</span> y_mean<span class="token punctuation">,</span> y_std <span class="token operator">=</span> normalize_target<span class="token punctuation">(</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o dataset</span></span>
<span class="line">dataset <span class="token operator">=</span> HousePriceDataset<span class="token punctuation">(</span>X_norm<span class="token punctuation">,</span> y_norm<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># T·∫°o DataLoader ƒë·ªÉ d·ªÖ d√†ng l·∫•y batch d·ªØ li·ªáu</span></span>
<span class="line">dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># Kh√¥ng h·ªçc 1000 m·∫´u c√πng l√∫c m√† h·ªçc t·ª´ng mini-batch (shuffle=True tr√°nh model h·ªçc theo th·ª© t·ª±)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>‚ú¶ Batch size ·∫£nh h∆∞·ªüng ƒë·∫øn c√°i g√¨?</p><table><thead><tr><th>Batch size</th><th>·∫¢nh h∆∞·ªüng</th></tr></thead><tbody><tr><td>Nh·ªè (8,16)</td><td>H·ªçc ch·∫≠m, noisy</td></tr><tr><td>Trung b√¨nh (32,64)</td><td>·ªîn ƒë·ªãnh, ph·ªï bi·∫øn</td></tr><tr><td>L·ªõn (256+)</td><td>Nhanh nh∆∞ng d·ªÖ overfit</td></tr></tbody></table></li><li><p>‚ú¶ Batch size trong AI th·ª±c t·∫ø ph·ªï bi·∫øn:</p><table><thead><tr><th>H·ªá th·ªëng</th><th>Batch</th></tr></thead><tbody><tr><td>OCR realtime</td><td>1‚Äì8</td></tr><tr><td>Chatbot embedding</td><td>32‚Äì128</td></tr><tr><td>Vision training</td><td>32‚Äì64</td></tr><tr><td>Fine-tune LLM</td><td>1‚Äì4</td></tr></tbody></table></li></ul><h4 id="‚ù∑-khoi-tao-model" tabindex="-1"><a class="header-anchor" href="#‚ù∑-khoi-tao-model"><span>‚ù∑ Kh·ªüi t·∫°o model</span></a></h4><ul><li><p><code>train.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Kh·ªüi t·∫°o model v·ªõi 3 feature</span></span>
<span class="line">model <span class="token operator">=</span> HousePriceModel<span class="token punctuation">(</span>input_dim<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∏-loss-function" tabindex="-1"><a class="header-anchor" href="#‚ù∏-loss-function"><span>‚ù∏ Loss Function</span></a></h4><ul><li><p><code>train.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Thi·∫øt l·∫≠p h√†m m·∫•t m√°t (Loss Function) v√† optimizer</span></span>
<span class="line">criterion <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>lr=001</code>: learning rate - M·ªói l·∫ßn update weight, ch·ªâ thay ƒë·ªïi 0.1% theo h∆∞·ªõng gi·∫£m loss.</p></li><li><p>Learning rate qu√° l·ªõn l√†m cho Loss nh·∫£y lo·∫°n.</p></li><li><p>Learning rate qu√° nh·ªè l√†m cho Loss gi·∫£m r·∫•t ch·∫≠m v√† train r·∫•t l√¢u.</p></li></ul></li></ul><h4 id="‚ùπ-training-loop" tabindex="-1"><a class="header-anchor" href="#‚ùπ-training-loop"><span>‚ùπ Training Loop</span></a></h4><ul><li><code>train.py</code>:</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">epochs <span class="token operator">=</span> <span class="token number">100</span>  <span class="token comment"># S·ªë epoch ƒë·ªÉ hu·∫•n luy·ªán (1 epoch = h·ªçc h·∫øt dataset 1 l·∫ßn)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    total_loss <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># L·∫∑p qua t·ª´ng batch</span></span>
<span class="line">    <span class="token keyword">for</span> X_batch<span class="token punctuation">,</span> y_batch <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># Forward pass (d·ª± ƒëo√°n)</span></span>
<span class="line">        preds <span class="token operator">=</span> model<span class="token punctuation">(</span>X_batch<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># T√≠nh loss (so s√°nh v·ªõi gi√° th·∫≠t)</span></span>
<span class="line">        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>preds<span class="token punctuation">,</span> y_batch<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># Zero gradients tr∆∞·ªõc khi backward (PyTorch c·ªông d·ªìn gradient ‚Üí n·∫øu kh√¥ng reset ‚Üí gradient sai)</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># Backward pass (t√≠nh gradient)</span></span>
<span class="line">        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># Weight thay ƒë·ªïi ‚Üí model th√¥ng minh h∆°n</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        total_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># In k·∫øt qu·∫£: Loss gi·∫£m = model h·ªçc ƒë∆∞·ª£c</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Epoch </span><span class="token interpolation"><span class="token punctuation">{</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>epochs<span class="token punctuation">}</span></span><span class="token string">, Loss: </span><span class="token interpolation"><span class="token punctuation">{</span>total_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="‚ù∫-luu-model-va-thong-tin-chuan-hoa" tabindex="-1"><a class="header-anchor" href="#‚ù∫-luu-model-va-thong-tin-chuan-hoa"><span>‚ù∫ L∆∞u model v√† th√¥ng tin chu·∫©n h√≥a</span></a></h4><ul><li><p><code>train.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;model_state&quot;</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;X_mean&quot;</span><span class="token punctuation">:</span> mean<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;X_std&quot;</span><span class="token punctuation">:</span> std<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;y_mean&quot;</span><span class="token punctuation">:</span> y_mean<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;y_std&quot;</span><span class="token punctuation">:</span> y_std</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;model.pth&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_7Ô∏è‚É£-du-ƒëoan" tabindex="-1"><a class="header-anchor" href="#_7Ô∏è‚É£-du-ƒëoan"><span>7Ô∏è‚É£ D·ª± ƒëo√°n</span></a></h3><h4 id="‚ù∂-load-checkpoint-an-toan" tabindex="-1"><a class="header-anchor" href="#‚ù∂-load-checkpoint-an-toan"><span>‚ù∂ Load checkpoint an to√†n</span></a></h4><ul><li><p>Load model ƒë√£ train v√† c√°c th√¥ng tin chu·∫©n h√≥a d·ªØ li·ªáu ƒë√£ l∆∞u tr∆∞·ªõc ƒë√≥:</p></li><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">checkpoint <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;model.pth&quot;</span><span class="token punctuation">,</span> weights_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">model_state <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">&quot;model_state&quot;</span><span class="token punctuation">]</span></span>
<span class="line">X_mean <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">&quot;X_mean&quot;</span><span class="token punctuation">]</span></span>
<span class="line">X_std <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">&quot;X_std&quot;</span><span class="token punctuation">]</span></span>
<span class="line">y_mean <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">&quot;y_mean&quot;</span><span class="token punctuation">]</span></span>
<span class="line">y_std <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">&quot;y_std&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∑-khoi-tao-model-ƒëa-hoc" tabindex="-1"><a class="header-anchor" href="#‚ù∑-khoi-tao-model-ƒëa-hoc"><span>‚ù∑ Kh·ªüi t·∫°o model ƒë√£ h·ªçc</span></a></h4><ul><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">model <span class="token operator">=</span> HousePriceModel<span class="token punctuation">(</span>input_dim<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∏-load-trong-so-ƒëa-hoc" tabindex="-1"><a class="header-anchor" href="#‚ù∏-load-trong-so-ƒëa-hoc"><span>‚ù∏ Load tr·ªçng s·ªë ƒë√£ h·ªçc</span></a></h4><ul><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>model_state<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="‚ùπ-chuyen-sang-che-ƒëo-ƒëanh-gia" tabindex="-1"><a class="header-anchor" href="#‚ùπ-chuyen-sang-che-ƒëo-ƒëanh-gia"><span>‚ùπ Chuy·ªÉn sang ch·∫ø ƒë·ªô ƒë√°nh gi√°</span></a></h4><ul><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="‚ù∫-chuan-bi-du-lieu-ƒëau-vao" tabindex="-1"><a class="header-anchor" href="#‚ù∫-chuan-bi-du-lieu-ƒëau-vao"><span>‚ù∫ Chu·∫©n b·ªã d·ªØ li·ªáu ƒë·∫ßu v√†o</span></a></h4><ul><li><p>Nh·∫≠p d·ªØ li·ªáu m·ªõi (ch∆∞a t·ª´ng th·∫•y) ƒë·ªÉ model d·ª± ƒëo√°n k·∫øt qu·∫£ gi√° nh√†.</p></li><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># T·∫°o m·ªôt m·∫´u d·ªØ li·ªáu ƒë·ªÉ d·ª± ƒëo√°n (1 cƒÉn nh√†: 120 m¬≤ + 3 ph√≤ng + c√°ch trung t√¢m 5 km)</span></span>
<span class="line">sample <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Normalize input gi·ªëng l√∫c train</span></span>
<span class="line">sample_norm <span class="token operator">=</span> <span class="token punctuation">(</span>sample <span class="token operator">-</span> X_mean<span class="token punctuation">)</span> <span class="token operator">/</span> X_std</span>
<span class="line">sample_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>sample_norm<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ùª-forward-‚Äì-ai-du-ƒëoan" tabindex="-1"><a class="header-anchor" href="#‚ùª-forward-‚Äì-ai-du-ƒëoan"><span>‚ùª Forward ‚Äì AI d·ª± ƒëo√°n</span></a></h4><ul><li><p>‚ö†Ô∏è Khi predict ph·∫£i d√πng c√πng mean &amp; std ƒë√£ chu·∫©n h√≥a tr∆∞·ªõc ƒë√≥.</p></li><li><p><code>predict.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># T·∫Øt gradient khi predict</span></span>
<span class="line">  <span class="token comment"># Forward ‚Äì AI d·ª± ƒëo√°n</span></span>
<span class="line">  y_pred_norm <span class="token operator">=</span> model<span class="token punctuation">(</span>sample_tensor<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Denormalize output ‚Üí gi√° th·∫≠t</span></span>
<span class="line">price <span class="token operator">=</span> y_pred_norm<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> y_std <span class="token operator">+</span> y_mean</span>
<span class="line"></span>
<span class="line"><span class="token comment"># In k·∫øt qu·∫£ ra d·∫°ng s·ªë</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Predicted price: </span><span class="token interpolation"><span class="token punctuation">{</span>price<span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string"> VND&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_7Ô∏è‚É£-chay-chuong-trinh-du-ƒëoan" tabindex="-1"><a class="header-anchor" href="#_7Ô∏è‚É£-chay-chuong-trinh-du-ƒëoan"><span>7Ô∏è‚É£ Ch·∫°y ch∆∞∆°ng tr√¨nh d·ª± ƒëo√°n</span></a></h3><h4 id="‚ù∂-chay-train-tao-model-du-ƒëoan-gia-nha" tabindex="-1"><a class="header-anchor" href="#‚ù∂-chay-train-tao-model-du-ƒëoan-gia-nha"><span>‚ù∂ Ch·∫°y TRAIN t·∫°o model d·ª± ƒëo√°n gi√° nh√†</span></a></h4><ul><li><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">python train.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>üëâ Sinh ra file <code>model.pth</code></li></ul></li></ul><h4 id="‚ù∑-chay-predict-du-ƒëoan" tabindex="-1"><a class="header-anchor" href="#‚ù∑-chay-predict-du-ƒëoan"><span>‚ù∑ Ch·∫°y PREDICT (d·ª± ƒëo√°n)</span></a></h4><ul><li><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">python predict.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>·ªû nh·ªØng l·∫ßn ch·∫°y d·ª± ƒëo√°n gi√° nh√† sau s·∫Ω kh√¥ng c·∫ßn ch·∫°y train n·ªØa (tr·ª´ khi mu·ªën train l·∫°i).</p></li></ul><h3 id="‚ö†Ô∏è-quan-trong" tabindex="-1"><a class="header-anchor" href="#‚ö†Ô∏è-quan-trong"><span>‚ö†Ô∏è Quan tr·ªçng:</span></a></h3><ul><li><p>Trong b√†i ƒëo√°n v·ª´a l√†m ch·ªâ l√† Linear Regression vi·∫øt b·∫±ng PyTorch, n√≥ ƒëang ph√π h·ª£p v·ªõi ho√†n c·∫£nh b√†i to√°n i·ªán t·∫°i:</p><ul><li>D·ªØ li·ªáu √≠t (di·ªán t√≠ch, s·ªë ph√≤ng, kho·∫£ng c√°ch)</li><li>Quan h·ªá g·∫ßn tuy·∫øn t√≠nh</li><li>üëâ Nhi·ªÅu h·ªá th·ªëng production c≈©ng ch·ªâ c·∫ßn c√≥ v·∫≠y.</li></ul></li><li><p>Tuy nhi√™n, th·ª±c t·∫ø s·∫Ω c√≥ nh·ªØng b√†i to√°n d·ª± ƒëo√°n v·ªõi data nhi·ªÅu, ph·ª• thu·ªôc ph·ª©c t·∫°p (quan h·ªá phi tuy·∫øn):</p><ul><li><p>V√≠ d·ª• gi√° nh√† ph·ª• thu·ªôc th√™m c·∫£ tu·ªïi th·ªç, n·ªôi th·∫•t, v.v.</p></li><li><p>üëâ Linear kh√¥ng bi·ªÉu di·ªÖn ƒë∆∞·ª£c ‚Äúlogic ƒëi·ªÅu ki·ªán‚Äù, v√† s·∫Ω c·∫ßn ƒë·∫øn Deep Learning v·ªõi c√°c hidden layers (MLP ‚Äì Multi-Layer Perceptron):</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">x ‚Üí Linear ‚Üí ReLU ‚Üí Linear ‚Üí ReLU ‚Üí Linear ‚Üí y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ul><p><a name="3"></a></p><h2 id="üìå-3-bai-toan-multi-layer-perceptron-binary-classification" tabindex="-1"><a class="header-anchor" href="#üìå-3-bai-toan-multi-layer-perceptron-binary-classification"><span>üìå 3. B√†i to√°n Multi-Layer Perceptron (Binary Classification)</span></a></h2><ul><li>B√†i to√°n: Giao d·ªãch b√¨nh th∆∞·ªùng / b·∫•t th∆∞·ªùng</li></ul><h3 id="_1Ô∏è‚É£-phan-tich-bai-toan-1" tabindex="-1"><a class="header-anchor" href="#_1Ô∏è‚É£-phan-tich-bai-toan-1"><span>1Ô∏è‚É£ Ph√¢n t√≠ch b√†i to√°n</span></a></h3><ul><li><p>Input: Th√¥ng tin giao d·ªãch</p></li><li><p>Output: B√¨nh th∆∞·ªùng / B·∫•t th∆∞·ªùng</p></li><li><p>‚ö†Ô∏è <strong>L∆∞u √Ω</strong>:</p><ul><li><p>‚úß Model s·∫Ω KH√îNG tr·∫£ v·ªÅ tr·ª±c ti·∫øp 0 (giao d·ªãch b√¨nh th∆∞·ªùng) v√† 1 (giao d·ªãch b·∫•t th∆∞·ªùng).</p></li><li><p>‚úß Model s·∫Ω tr·∫£ v·ªÅ 1 s·ªë th·ª±c (g·ªçi l√† <strong>logit</strong>) ‚Üí sau ƒë√≥ qua <strong>Sigmoid</strong> (h√†m Logistic - ƒë∆∞·ªùng ch·ªØ S) ‚Üí <strong>x√°c su·∫•t</strong>.</p></li><li><p>‚úß V√≠ d·ª•:</p><table><thead><tr><th>Logit</th><th>Sigmoid</th><th>K·∫øt lu·∫≠n</th></tr></thead><tbody><tr><td>2.3</td><td>0.91</td><td>B·∫•t th∆∞·ªùng</td></tr><tr><td>-1.2</td><td>0.23</td><td>B√¨nh th∆∞·ªùng</td></tr></tbody></table><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">prob &gt;= 0.5 ‚Üí b·∫•t th∆∞·ªùng</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="_2Ô∏è‚É£-du-lieu-gia-lap-1" tabindex="-1"><a class="header-anchor" href="#_2Ô∏è‚É£-du-lieu-gia-lap-1"><span>2Ô∏è‚É£ D·ªØ li·ªáu gi·∫£ l·∫≠p</span></a></h3><ul><li><p>M·ªói giao d·ªãch c√≥ c√°c ƒë·∫∑c tr∆∞ng (feature).</p><ul><li>V√≠ d·ª•: <table><thead><tr><th>Feature</th><th>√ù nghƒ©a</th></tr></thead><tbody><tr><td>amount</td><td>S·ªë ti·ªÅn</td></tr><tr><td>hour</td><td>Gi·ªù giao d·ªãch (0‚Äì23)</td></tr><tr><td>location_score</td><td>M·ª©c ƒë·ªô l·∫° c·ªßa v·ªã tr√≠</td></tr><tr><td>device_score</td><td>M·ª©c ƒë·ªô l·∫° c·ªßa thi·∫øt b·ªã</td></tr><tr><td>freq_24h</td><td>S·ªë giao d·ªãch 24h g·∫ßn nh·∫•t</td></tr></tbody></table></li></ul></li><li><p>Trong b√†i n√†y ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng dataset m·∫´u c√≥ r·∫•t nhi·ªÅu feature.</p><ul><li>üëâ Tuy nhi√™n, b·∫°n c≈©ng kh√¥ng c·∫ßn thi·∫øt hi·ªÉu √Ω nghƒ©a t·ª´ng feature nh∆∞ v·∫≠y, b·ªüi sau c√πng th√¨ Neural Network ch·ªâ c·∫ßn s·ªë, kh√¥ng c·∫ßn bi·∫øt ƒë√≥ l√† g√¨.</li></ul></li></ul><h3 id="_3Ô∏è‚É£-import-du-lieu" tabindex="-1"><a class="header-anchor" href="#_3Ô∏è‚É£-import-du-lieu"><span>3Ô∏è‚É£ Import d·ªØ li·ªáu</span></a></h3><ul><li>Ch√∫ng ta s·∫Ω d√πng Dataset c√≥ s·∫µn do <a href="https://www.kaggle.com" target="_blank" rel="noopener noreferrer">Kaggle</a> cung c·∫•p.</li></ul><h4 id="‚ù∂-tai-dataset-mau" tabindex="-1"><a class="header-anchor" href="#‚ù∂-tai-dataset-mau"><span>‚ù∂ T·∫£i Dataset m·∫´u</span></a></h4><ul><li><p>T·∫£i dataset Credit Card Fraud Detection <a href="https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud" target="_blank" rel="noopener noreferrer">t·∫°i ƒë√¢y</a>.</p></li><li><p>Gi·∫£i n√©n ra file <code>creditcard.csv</code> v√† ƒë·∫∑t v√†o project.</p></li></ul><h4 id="‚ù∑-chia-train-validation" tabindex="-1"><a class="header-anchor" href="#‚ù∑-chia-train-validation"><span>‚ù∑ Chia train / validation</span></a></h4><ul><li><p>H√£y ƒë√°nh gi√° l·∫°i Dataset m·∫´u ch√∫ng ta s·ª≠ d·ª•ng:</p><ul><li>~99.8% l√† c√°c data c√≥ class = 0 (giao d·ªãch b√¨nh th∆∞·ªùng)</li><li>~0.2% l√† c√°c data c√≥ class = 1 (fraud - giao d·ªãch b·∫•t th∆∞·ªùng)</li><li>üëâ M·∫•t c√¢n b·∫±ng nghi√™m tr·ªçng.</li></ul></li><li><p>‚ùì Chuy·ªán g√¨ x·∫£y ra n·∫øu KH√îNG chia train / validation?</p><ul><li><p>Gi·∫£ s·ª≠ 1000 giao d·ªãch:</p><ul><li>‚úß 998 normal</li><li>‚úß 2 fraud</li></ul></li><li><p>Chia train / validation = 80/20:</p><ul><li>‚úß Train: 798 normal + 2 fraud</li><li>‚úß Val: 200 normal + 0 fraud ‚ùå</li></ul></li><li><p>üëâ ƒê√°nh gi√° l√† <strong>v√¥ nghƒ©a</strong> do validation kh√¥ng c√≥ fraud n√†o.</p></li></ul></li><li><p>V·ªõi AI c·∫£nh b√°o, validation tr·ªü n√™n v√¥ c√πng quan tr·ªçng:</p><ul><li>Sai 1 giao d·ªãch = h·∫≠u qu·∫£ l·ªõn.</li></ul></li><li><p>‚úÖ Do v·∫≠y, ch√∫ng ta c·∫ßn gi·ªØ t·ª∑ l·ªá fraud gi·ªëng nhau ·ªü train &amp; val.</p></li><li><p><code>prepare_data.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"></span>
<span class="line">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;data/creditcard.csv&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">train_df<span class="token punctuation">,</span> temp_df <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span></span>
<span class="line">    df<span class="token punctuation">,</span></span>
<span class="line">    test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span></span>
<span class="line">    random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span></span>
<span class="line">    stratify<span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token string">&quot;Class&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">val_df<span class="token punctuation">,</span> test_df <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span></span>
<span class="line">    temp_df<span class="token punctuation">,</span></span>
<span class="line">    test_size<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span></span>
<span class="line">    random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span></span>
<span class="line">    stratify<span class="token operator">=</span>temp_df<span class="token punctuation">[</span><span class="token string">&quot;Class&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">train_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&quot;data/train.csv&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">val_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&quot;data/val.csv&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">test_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&quot;data/test.csv&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>‚úß ·ªû ƒë√¢y ch√∫ng ta chia 70% d·ªØ li·ªáu cho training, 30% cho validation v√† test (trong 30% n√†y chia 50:50 cho validation v√† test).</li><li>‚úß D·ªØ li·ªáu sau khi chia ƒë∆∞·ª£c l∆∞u v√†o 3 file <code>.csv</code> ri√™ng bi·ªát.</li><li>‚úß <code>stratify = df[&quot;Class&quot;] (y)</code> gi·ªØ t·ª∑ l·ªá fraud gi·ªëng nhau ·ªü train &amp; val.</li></ul></li></ul><h4 id="‚ù∏-chuan-hoa-du-lieu" tabindex="-1"><a class="header-anchor" href="#‚ù∏-chuan-hoa-du-lieu"><span>‚ù∏ Chu·∫©n h√≥a d·ªØ li·ªáu</span></a></h4><ul><li><p>N·∫øu quan s√°t Dataset m·∫´u s·∫Ω th·∫•y:</p><ul><li>V1..V28 ‚Üí gi√° tr·ªã quanh 0.</li><li>Amount ‚Üí c√≥ th·ªÉ l√™n t·ªõi v√†i ch·ª•c ngh√¨n.</li></ul></li><li><p>‚ùå N·∫øu kh√¥ng chu·∫©n h√≥a:</p><ul><li>Neural Network h·ªçc l·ªách.</li><li>Gradient kh√≥ h·ªôi t·ª•.</li></ul></li><li><p>‚úîÔ∏è Ch√∫ng ta s·∫Ω d√πng c√¥ng c·ª• h·ªó tr·ª£ chu·∫©n h√≥a ph·ªï bi·∫øn <code>StandardScaler</code>.</p></li><li><p><code>fit_scaler.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler</span>
<span class="line"><span class="token keyword">import</span> joblib</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ƒê·ªçc d·ªØ li·ªáu hu·∫•n luy·ªán</span></span>
<span class="line">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;data/train.csv&quot;</span><span class="token punctuation">)</span></span>
<span class="line">X <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;Class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Chu·∫©n h√≥a d·ªØ li·ªáu</span></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">scaler<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># L∆∞u tr·ªØ scaler</span></span>
<span class="line">joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>scaler<span class="token punctuation">,</span> <span class="token string">&quot;artifacts/scaler.pkl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>T·∫°m th·ªùi kh√¥ng d√πng c·ªôt <code>Time</code> do ƒë√¢y l√† s·ªë gi√¢y k·ªÉ t·ª´ giao d·ªãch ƒë·∫ßu ti√™n, kh√¥ng mang √Ω nghƒ©a r√µ r√†ng cho b√†i to√°n anomaly ‚Üí d·ªÖ g√¢y nhi·ªÖu.</p></li><li><p>C·ªôt <code>Class</code> d√πng cho label (nh√£n) ‚Üí t·ªïng c√≤n 29 feature.</p></li></ul></li><li><p>‚ö†Ô∏è KH√îNG chu·∫©n h√≥a <code>y</code> trong b√†i to√°n Classification b·ªüi <code>y</code> mang √Ω nghƒ©a logic (0 ho·∫∑c 1) ch·ª© kh√¥ng ph·∫£i gi√° tr·ªã ƒëo l∆∞·ªùng.</p></li></ul><h3 id="_4Ô∏è‚É£-tao-pytorch-dataset" tabindex="-1"><a class="header-anchor" href="#_4Ô∏è‚É£-tao-pytorch-dataset"><span>4Ô∏è‚É£ T·∫°o PyTorch Dataset</span></a></h3><ul><li><p>Khi training, validation v√† test th√¨ ƒë·ªÅu c·∫ßn t·∫°o Dataset</p><ul><li>üëâ Ta s·∫Ω truy·ªÅn <code>csv_path</code> ƒë·∫øn file d·ªØ li·ªáu m·∫´u ƒë√£ chia ban ƒë·∫ßu.</li></ul></li><li><p><code>dataset.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> Dataset</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">FraudDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> csv_path<span class="token punctuation">,</span> scaler<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>csv_path<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        X_df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;Class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&quot;Class&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Chu·∫©n h√≥a d·ªØ li·ªáu n·∫øu scaler ƒë∆∞·ª£c cung c·∫•p</span></span>
<span class="line">        <span class="token keyword">if</span> scaler <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># √Åp d·ª•ng chu·∫©n h√≥a (mean, std) ƒë√£ h·ªçc</span></span>
<span class="line">            X <span class="token operator">=</span> scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_df<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            X <span class="token operator">=</span> X_df<span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line">        self<span class="token punctuation">.</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">[</span>idx<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_5Ô∏è‚É£-ƒëinh-nghia-model-1" tabindex="-1"><a class="header-anchor" href="#_5Ô∏è‚É£-ƒëinh-nghia-model-1"><span>5Ô∏è‚É£ ƒê·ªãnh nghƒ©a Model</span></a></h3><ul><li><p><code>model.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">FraudMLP</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span></span>
<span class="line">            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>C·∫•u tr√∫c MLP c∆° b·∫£n:</p><div class="language-scss line-numbers-mode" data-highlighter="prismjs" data-ext="scss" data-title="scss"><pre><code><span class="line">Input <span class="token punctuation">(</span>29<span class="token punctuation">)</span></span>
<span class="line">   ‚Üì</span>
<span class="line"><span class="token function">Linear</span><span class="token punctuation">(</span>29 ‚Üí 64<span class="token punctuation">)</span></span>
<span class="line">   ‚Üì</span>
<span class="line">ReLU</span>
<span class="line">   ‚Üì</span>
<span class="line"><span class="token function">Linear</span><span class="token punctuation">(</span>64 ‚Üí 32<span class="token punctuation">)</span></span>
<span class="line">   ‚Üì</span>
<span class="line">ReLU</span>
<span class="line">   ‚Üì</span>
<span class="line"><span class="token function">Linear</span><span class="token punctuation">(</span>32 ‚Üí 1<span class="token punctuation">)</span></span>
<span class="line">   ‚Üì</span>
<span class="line">Logits</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>Linear(29 ‚Üí 64)</code>: Layer 1 - l·∫•y 29 s·ªë ƒë·∫ßu v√†o t·∫°o ra 64 ƒë·∫∑c tr∆∞ng m·ªõi.</p><ul><li>V√≠ d·ª•: <ul><li>Feature 1: ‚Äúm·∫´u giao d·ªãch l·∫° ban ƒë√™m‚Äù</li><li>Feature 2: ‚Äús·ªë ti·ªÅn cao + v·ªã tr√≠ b·∫•t th∆∞·ªùng‚Äù</li><li>v.v.</li></ul></li></ul></li><li><p><code>Linear(64 ‚Üí 32)</code>: Layer 2 - gom 64 ƒë·∫∑c tr∆∞ng trung gian, ch·∫Øt l·ªçc th√†nh 32 ƒë·∫∑c tr∆∞ng tr·ª´u t∆∞·ª£ng h∆°n.</p><ul><li>N√¥m na n·∫øu coi Layer 1 l√† c√°c pattern nh·ªè th√¨ Layer 2 cho ch√∫ng ta th·∫•y c√°c d·∫•u hi·ªáu gian l·∫≠n, b·∫•t th∆∞·ªùng.</li></ul></li><li><p><code>Linear(32 ‚Üí 1)</code>: Output layer - 1 con s·ªë duy nh·∫•t th·ªÉ hi·ªán ƒë·ªô tin (ch∆∞a ph·∫£i x√°c su·∫•t m√† m·ªõi ch·ªâ l√† <strong>logit</strong>) r·∫±ng giao d·ªãch n√†y l√† fraud.</p></li><li><p><code>ReLU</code>: T·∫°o phi tuy·∫øn, cho ph√©p model h·ªçc quan h·ªá ph·ª©c t·∫°p.</p><ul><li>V√≠ d·ª• mu·ªën ph√°t hi·ªán ‚ÄúGiao d·ªãch ban ƒë√™m v√† s·ªë ti·ªÅn l·ªõn th√¨ ƒë√°ng nghi‚Äù: <ul><li>N·∫øu ban ng√†y ‚Üí gi√° tr·ªã √¢m ‚Üí ReLU = 0 ‚Üí kh√¥ng quan t√¢m</li><li>N·∫øu ban ƒë√™m ‚Üí gi√° tr·ªã d∆∞∆°ng ‚Üí ReLU gi·ªØ l·∫°i ‚Üí k√≠ch ho·∫°t</li><li>üëâ N·∫øu kh√¥ng c√≥ <code>ReLU</code>: tr·ªùi s√°ng hay t·ªëi kh√¥ng quan t√¢m ‚Üí ban ng√†y v·∫´n b·ªã ƒë√°ng nghi</li></ul></li></ul></li></ul></li><li><p>‚ö†Ô∏è <strong>L∆∞u √Ω</strong>:</p><ul><li>C√°c con s·ªë 64, 32 l√† do kinh nghi·ªám + th·ª≠ nghi·ªám, kh√¥ng c√≥ c√¥ng th·ª©c ch√≠nh x√°c.</li></ul></li></ul><h3 id="_6Ô∏è‚É£-training-loop-1" tabindex="-1"><a class="header-anchor" href="#_6Ô∏è‚É£-training-loop-1"><span>6Ô∏è‚É£ Training Loop</span></a></h3><ul><li><p>Nh√¨n chung, khung Training Loop trong b√†i to√°n n√†y c≈©ng t∆∞∆°ng t·ª± b√†i to√°n D·ª± ƒëo√°n gi√° nh√†.</p><ul><li><p>ƒêi·ªÉm kh√°c bi·ªát l√† s·ª≠ d·ª•ng h√†m m·∫•t m√°t (Loss Function) <code>BCEWithLogitsLoss</code> gi√∫p t·ª± ƒë·ªông √°p d·ª•ng Sigmoid:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">BCEWithLogitsLoss = Sigmoid(logit) + BCELoss</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><code>train.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">import</span> joblib</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader</span>
<span class="line"><span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token punctuation">,</span> optim</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> model <span class="token keyword">import</span> FraudMLP</span>
<span class="line"><span class="token keyword">from</span> dataset <span class="token keyword">import</span> FraudDataset</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Load scaler</span></span>
<span class="line">scaler <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/scaler.pkl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o Dataset</span></span>
<span class="line">train_ds <span class="token operator">=</span> FraudDataset<span class="token punctuation">(</span><span class="token string">&quot;data/train.csv&quot;</span><span class="token punctuation">,</span> scaler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o DataLoader</span></span>
<span class="line">train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>train_ds<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kh·ªüi t·∫°o model, loss function v√† optimizer</span></span>
<span class="line">model <span class="token operator">=</span> FraudMLP<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCEWithLogitsLoss<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Hu·∫•n luy·ªán m√¥ h√¨nh</span></span>
<span class="line">EPOCHS <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line"><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>EPOCHS<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    total_loss <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span></span>
<span class="line">        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        logits <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line">        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>logits<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        total_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    avg_loss <span class="token operator">=</span> total_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Epoch </span><span class="token interpolation"><span class="token punctuation">{</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, loss=</span><span class="token interpolation"><span class="token punctuation">{</span>avg_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;artifacts/model.pth&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_7Ô∏è‚É£-validation-metrics" tabindex="-1"><a class="header-anchor" href="#_7Ô∏è‚É£-validation-metrics"><span>7Ô∏è‚É£ Validation &amp; Metrics</span></a></h3><ul><li><p>‚ùå Training loss ch·ªâ cho bi·∫øt model nh·ªõ data train t·ªët t·ªõi ƒë√¢u, kh√¥ng gi√∫p t·ªïng qu√°t h√≥a model.</p><ul><li>B·ªüi th·ª±c t·∫ø v·ªõi data m√† model ch∆∞a t·ª´ng th·∫•y, output c√≥ th·ªÉ fail.</li></ul></li><li><p>‚úîÔ∏è Validation gi√∫p:</p><ul><li><p>‚ú¶ Ki·ªÉm tra kh·∫£ nƒÉng t·ªïng qu√°t:</p><ul><li>Model h·ªçc c√≥ √°p d·ª•ng ƒë∆∞·ª£c cho d·ªØ li·ªáu m·ªõi kh√¥ng?</li></ul></li><li><p>‚ú¶ Quy·∫øt ƒë·ªãnh d·ª´ng train:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Epoch 10: Val loss nh·ªè nh·∫•t ‚Üí gi·ªØ model</span>
<span class="line">Epoch 11+: Val loss tƒÉng ‚Üí stop</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>‚ú¶ So s√°nh model / hyperparameter:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">LR = 0.01 ‚Üí val loss = 0.42</span>
<span class="line">LR = 0.001 ‚Üí val loss = 0.31 ‚úÖ</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>üëâ Ch·ªçn c√°i t·ªët tr√™n validation, kh√¥ng ph·∫£i train.</li></ul></li><li><p>‚ú¶ Ch·ªçn threshold / metric ph√π h·ª£p:</p><ul><li><p>‚úß V·ªõi l∆∞·ª£ng Dataset m·∫´u 99% l√† normal, 1% l√† fraud:</p><ul><li>V√≠ d·ª• output: <table><thead><tr><th>Giao d·ªãch</th><th>X√°c su·∫•t fraud</th></tr></thead><tbody><tr><td>Fraud th·∫≠t</td><td>0.42</td></tr><tr><td>Fraud th·∫≠t</td><td>0.37</td></tr><tr><td>Normal</td><td>0.05</td></tr></tbody></table></li><li>üëâ N·∫øu threshold = 0.5 s·∫Ω kh√¥ng b·∫Øt ƒë∆∞·ª£c fraud n√†o.</li></ul></li><li><p>‚úß Ch√∫ng ta s·∫Ω c·∫ßn:</p><ul><li><p>‚ûÄ Precision</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Trong nh·ªØng c√°i m√¨nh b√°o fraud ‚Üí bao nhi√™u c√°i l√† fraud th·∫≠t</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>üëâ Precision cao ‚Üí √≠t b√°o nh·∫ßm</li></ul></li><li><p>‚ûÅ Recall</p></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Trong t·∫•t c·∫£ fraud th·∫≠t ‚Üí m√¨nh b·∫Øt ƒë∆∞·ª£c bao nhi√™u</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>üëâ Recall th·∫•p ‚Üí b·ªè s√≥t gian l·∫≠n</li></ul></li><li><p>üî• <strong>T√≥m l·∫°i</strong>:</p><ul><li><p>‚úß Kh√¥ng c√≥ threshold ‚Äúƒë√∫ng‚Äù, ch·ªâ c√≥ threshold ph√π h·ª£p m·ª•c ti√™u kinh doanh.</p></li><li><p>‚úß Ch·ªçn threshold: ∆Øu ti√™n Recall (Recall ‚â• 85%) ho·∫∑c c√¢n b·∫±ng Precision / Recall ho·∫∑c c√¢n b·∫±ng chi ph√≠ ti·ªÅn b·∫°c:</p><ul><li>V√≠ d·ª•: <ul><li>B·ªè s√≥t 1 fraud = m·∫•t 1.000$</li><li>B√°o nh·∫ßm 1 giao d·ªãch = t·ªën 5$</li><li>üëâ Ta ch·ªçn threshold b√°o nh·∫ßm c√≤n h∆°n b·ªè s√≥t.</li></ul></li></ul></li></ul></li></ul></li></ul></li><li><p>‚ö†Ô∏è <strong>Validation loop ch·ªâ forward + ƒëo metric, KH√îNG backward.</strong></p></li><li><p><code>validation.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">import</span> joblib</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> recall_score</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> dataset <span class="token keyword">import</span> FraudDataset</span>
<span class="line"><span class="token keyword">from</span> model <span class="token keyword">import</span> FraudMLP</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Load scaler</span></span>
<span class="line">scaler <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/scaler.pkl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o Dataset</span></span>
<span class="line">val_ds <span class="token operator">=</span> FraudDataset<span class="token punctuation">(</span><span class="token string">&quot;data/val.csv&quot;</span><span class="token punctuation">,</span> scaler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o DataLoader</span></span>
<span class="line">val_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>val_ds<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kh·ªüi t·∫°o model</span></span>
<span class="line">model <span class="token operator">=</span> FraudMLP<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">state_dict <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/model.pth&quot;</span><span class="token punctuation">,</span> weights_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>state_dict<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Chuy·ªÉn ƒë·ªïi model sang ch·∫ø ƒë·ªô ƒë√°nh gi√°</span></span>
<span class="line">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">all_probs<span class="token punctuation">,</span> all_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> val_loader<span class="token punctuation">:</span></span>
<span class="line">        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        logits <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line">        probs <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>logits<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        all_probs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>probs<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        all_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># G·ªôp t·∫•t c·∫£ c√°c d·ª± ƒëo√°n v√† nh√£n l·∫°i</span></span>
<span class="line">probs <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>all_probs<span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">labels <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>all_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kh·ªüi t·∫°o threshold m·∫∑c ƒë·ªãnh ban ƒë·∫ßu</span></span>
<span class="line">best_threshold<span class="token punctuation">,</span> best_recall <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T√¨m ki·∫øm ng∆∞·ª°ng t·ªët nh·∫•t</span></span>
<span class="line"><span class="token comment"># Qu√©t threshold t·ª´ 0.1 ƒë·∫øn 0.9 v·ªõi step 0.05 ƒë·ªÉ t·ªëi ∆∞u h√≥a</span></span>
<span class="line"><span class="token keyword">for</span> t <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># D·ª± ƒëo√°n nh√£n</span></span>
<span class="line">    preds <span class="token operator">=</span> <span class="token punctuation">(</span>probs <span class="token operator">&gt;=</span> t<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># T√≠nh Recall</span></span>
<span class="line">    recall <span class="token operator">=</span> recall_score<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> preds<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Gi·ªØ threshold t·ªët nh·∫•t</span></span>
<span class="line">    <span class="token keyword">if</span> recall <span class="token operator">&gt;</span> best_recall<span class="token punctuation">:</span></span>
<span class="line">        best_recall <span class="token operator">=</span> recall</span>
<span class="line">        best_threshold <span class="token operator">=</span> t</span>
<span class="line"></span>
<span class="line"><span class="token comment"># L∆∞u threshold v√† recall t·ªët nh·∫•t v√†o file config.json</span></span>
<span class="line">config <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;threshold&quot;</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>best_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;recall&quot;</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>best_recall<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;artifacts/config.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>config<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Best threshold:&quot;</span><span class="token punctuation">,</span> best_threshold<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_8Ô∏è‚É£-test" tabindex="-1"><a class="header-anchor" href="#_8Ô∏è‚É£-test"><span>8Ô∏è‚É£ Test</span></a></h3><ul><li><p>‚ú¶ L√† b∆∞·ªõc ƒë√°nh gi√° cu·ªëi c√πng.</p></li><li><p>‚ú¶ Khi test ph·∫£i d√πng d·ªØ li·ªáu th·ª±c t·∫ø m√† model ch∆∞a t·ª´ng th·∫•y.</p><ul><li>üëâ Ch√∫ng ta s·ª≠ d·ª•ng d·ªØ li·ªáu test ƒë√£ chia ban ƒë·∫ßu.</li></ul></li><li><p>‚ú¶ Sau b∆∞·ªõc validation, ch√∫ng ta ƒë√£ kh√≥a model + threshold.</p><ul><li>üëâ Giai ƒëo·∫°n test s·∫Ω √°p d·ª•ng threshold ƒë√£ ch·ªçn ƒë·ªÉ ki·ªÉm ch·ª©ng vi·ªác n·∫øu ƒë∆∞a model ra production th√¨ n√≥ s·∫Ω ho·∫°t ƒë·ªông ra sao.</li></ul></li><li><p>‚ú¶ ƒê·ªÉ ki·ªÉm ch·ª©ng k·∫øt qu·∫£ test:</p><ul><li>‚úß C√≥ b·ªè s√≥t fraud nhi·ªÅu kh√¥ng?</li><li>‚úß B√°o nh·∫ßm bao nhi√™u?</li><li>üëâ Log b√°o c√°o test l√† kh√¢u quan tr·ªçng v√† b·∫Øt bu·ªôc.</li></ul></li><li><p><code>test.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">import</span> joblib</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report<span class="token punctuation">,</span> roc_auc_score</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> model <span class="token keyword">import</span> FraudMLP</span>
<span class="line"><span class="token keyword">from</span> dataset <span class="token keyword">import</span> FraudDataset</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Load scaler</span></span>
<span class="line">scaler <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/scaler.pkl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o Dataset</span></span>
<span class="line">test_ds <span class="token operator">=</span> FraudDataset<span class="token punctuation">(</span><span class="token string">&quot;data/test.csv&quot;</span><span class="token punctuation">,</span> scaler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T·∫°o DataLoader</span></span>
<span class="line">test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>test_ds<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Kh·ªüi t·∫°o model</span></span>
<span class="line">model <span class="token operator">=</span> FraudMLP<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">state_dict <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/model.pth&quot;</span><span class="token punctuation">,</span> weights_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>state_dict<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Chuy·ªÉn ƒë·ªïi model sang ch·∫ø ƒë·ªô ƒë√°nh gi√°</span></span>
<span class="line">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># T√¨m ng∆∞·ª°ng t·ªëi ∆∞u h·ªçc t·ª´ validation</span></span>
<span class="line"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;artifacts/config.json&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">    threshold <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;threshold&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">all_probs<span class="token punctuation">,</span> all_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span></span>
<span class="line">        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        probs <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>model<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        all_probs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>probs<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        all_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">probs <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>all_probs<span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">labels <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>all_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># D·ª± ƒëo√°n nh√£n</span></span>
<span class="line">preds <span class="token operator">=</span> <span class="token punctuation">(</span>probs <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> preds<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;AUC:&quot;</span><span class="token punctuation">,</span> roc_auc_score<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> probs<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>‚ú¶ V√≠ d·ª• log k·∫øt qu·∫£ test:</p><ul><li><p><strong>‚ûÄ <code>classification_report</code> ‚Äì ƒê·ªçc T·ª™NG D√íNG</strong></p><div class="language-markdown line-numbers-mode" data-highlighter="prismjs" data-ext="md" data-title="md"><pre><code><span class="line">                  precision    recall  f1-score   support</span>
<span class="line"></span>
<span class="line"><span class="token code keyword">            0.0       1.00      1.00      1.00      42648</span>
<span class="line">            1.0       0.77      0.84      0.80         74</span></span>
<span class="line"></span>
<span class="line"><span class="token code keyword">      accuracy                            1.00      42722</span>
<span class="line">      macro avg       0.88      0.92      0.90      42722</span>
<span class="line">    weighted avg      1.00      1.00      1.00      42722</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Ch√∫ng ta s·∫Ω ch·ªâ quan t√¢m d√≤ng <code>1.0</code>: <ul><li><code>support = 74</code>: c√≥ 74 giao d·ªãch gian l·∫≠n th·∫≠t tr√™n 42648 giao d·ªãch.</li><li><code>recall = 0.84</code>: trong 74 giao d·ªãch gian l·∫≠n model b·∫Øt ƒë∆∞·ª£c 84% (‚â• 0.8 l√† T·ªêT).</li><li><code>precision = 0.77</code>: trong c√°c giao d·ªãch model b·∫Øt gian l·∫≠n, 77% l√† th·∫≠t.</li><li><code>f1-score = 0.80</code>: trung b√¨nh c·ªßa precision &amp; recall (‚â• 0.75 l√† T·ªêT).</li></ul></li></ul></li><li><p><strong>‚ûÅ <code>roc_auc_score</code></strong></p><ul><li>L√† x√°c xu·∫•t model ∆∞u ti√™n ƒë√°nh gi√° 1 giao d·ªãch gian l·∫≠n hay kh√¥ng l√™n tr√™n giao d·ªãch b√¨nh th∆∞·ªùng.</li><li>AUC KH√îNG ph·ª• thu·ªôc threshold.</li><li><table><thead><tr><th>AUC</th><th>ƒê√°nh gi√°</th></tr></thead><tbody><tr><td>0.5</td><td>Random</td></tr><tr><td>0.7</td><td>T·∫°m</td></tr><tr><td>0.8</td><td>T·ªët</td></tr><tr><td>0.9</td><td>R·∫•t t·ªët</td></tr><tr><td>0.97</td><td>Xu·∫•t s·∫Øc</td></tr></tbody></table></li></ul></li></ul></li></ul><h3 id="_9Ô∏è‚É£-trien-khai-inference-ƒëua-model-ƒëa-train-ra-su-dung-that" tabindex="-1"><a class="header-anchor" href="#_9Ô∏è‚É£-trien-khai-inference-ƒëua-model-ƒëa-train-ra-su-dung-that"><span>9Ô∏è‚É£ Tri·ªÉn khai inference - ƒê∆∞a model ƒë√£ train ra s·ª≠ d·ª•ng th·∫≠t</span></a></h3><h4 id="‚ûÄ-muc-tieu" tabindex="-1"><a class="header-anchor" href="#‚ûÄ-muc-tieu"><span>‚ûÄ M·ª•c ti√™u</span></a></h4><ul><li><p>ƒê∆∞a model ƒë√£ train ra s·ª≠ d·ª•ng th·∫≠t.</p></li><li><p>S·ª≠ d·ª•ng ƒë∆∞·ª£c cho c√°c giao d·ªãch realtime ‚Üí c·∫ßn nhanh.</p></li><li><p>Kh√¥ng b·ªã l·ªá thu·ªôc code train.</p></li><li><p>K·∫øt qu·∫£ gi·ªëng test.</p></li></ul><h4 id="‚ûÅ-chuan-hoa-artifact-can-deploy" tabindex="-1"><a class="header-anchor" href="#‚ûÅ-chuan-hoa-artifact-can-deploy"><span>‚ûÅ Chu·∫©n h√≥a artifact c·∫ßn deploy</span></a></h4><ul><li><p>Sau khi train xong, deploy KH√îNG c·∫ßn dataset:</p><ul><li><p>‚úîÔ∏è Ch·ªâ c·∫ßn:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">artifacts/</span>
<span class="line">‚îú‚îÄ‚îÄ model.pth        # weight</span>
<span class="line">‚îú‚îÄ‚îÄ scaler.pkl       # fitted scaler (chu·∫©n h√≥a d·ªØ li·ªáu)</span>
<span class="line">‚îú‚îÄ‚îÄ config.json      # threshold</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>‚ùå Kh√¥ng c·∫ßn:</p><ul><li><code>train.py</code></li><li><code>validation.py</code></li><li><code>creditcard.csv</code></li></ul></li></ul></li></ul><h4 id="‚ûÇ-inference-pipeline" tabindex="-1"><a class="header-anchor" href="#‚ûÇ-inference-pipeline"><span>‚ûÇ Inference pipeline</span></a></h4><ul><li><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Raw input</span>
<span class="line">   ‚Üì</span>
<span class="line">Preprocessing (chu·∫©n h√≥a d·ªØ li·ªáu)</span>
<span class="line">   ‚Üì</span>
<span class="line">Tensor</span>
<span class="line">   ‚Üì</span>
<span class="line">Model (logits)</span>
<span class="line">   ‚Üì</span>
<span class="line">Sigmoid ‚Üí x√°c su·∫•t</span>
<span class="line">   ‚Üì</span>
<span class="line">Threshold</span>
<span class="line">   ‚Üì</span>
<span class="line">Decision (Normal / Fraud)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ûÉ-thiet-ke-deploy-structure" tabindex="-1"><a class="header-anchor" href="#‚ûÉ-thiet-ke-deploy-structure"><span>‚ûÉ Thi·∫øt k·∫ø deploy structure</span></a></h4><ul><li><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">inference/</span>
<span class="line">‚îú‚îÄ‚îÄ inference.py</span>
<span class="line">‚îú‚îÄ‚îÄ model_loader.py</span>
<span class="line">‚îú‚îÄ‚îÄ preprocess.py</span>
<span class="line">‚îú‚îÄ‚îÄ schema.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>model_loader.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">from</span> model <span class="token keyword">import</span> FraudMLP</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">load_model</span><span class="token punctuation">(</span>model_path<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model <span class="token operator">=</span> FraudMLP<span class="token punctuation">(</span>input_dim<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span></span>
<span class="line">    state_dict <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_path<span class="token punctuation">,</span> weights_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> map_location<span class="token operator">=</span>device<span class="token punctuation">)</span>  <span class="token comment">#  map_location=device ‚Üí ch·∫°y ƒë∆∞·ª£c c·∫£ CPU/GPU</span></span>
<span class="line">    model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>state_dict<span class="token punctuation">)</span></span>
<span class="line">    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> model</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>preprocess.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> inference<span class="token punctuation">.</span>schema <span class="token keyword">import</span> FEATURE_ORDER</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> scaler<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>features<span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span>FEATURE_ORDER<span class="token punctuation">)</span></span>
<span class="line">    x_scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>df<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> x_scaled</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>schema.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">FEATURE_ORDER <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;V1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;V2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;V3&quot;</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token string">&quot;V28&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Amount&quot;</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">validate_features</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> f <span class="token keyword">in</span> FEATURE_ORDER<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> f <span class="token keyword">not</span> <span class="token keyword">in</span> features<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Missing feature: </span><span class="token interpolation"><span class="token punctuation">{</span>f<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>inference.py</code>:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">import</span> joblib</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">from</span> inference<span class="token punctuation">.</span>model_loader <span class="token keyword">import</span> load_model</span>
<span class="line"><span class="token keyword">from</span> inference<span class="token punctuation">.</span>preprocess <span class="token keyword">import</span> preprocess</span>
<span class="line"></span>
<span class="line">DEVICE <span class="token operator">=</span> <span class="token string">&quot;cpu&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">FraudInference</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>scaler <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;artifacts/scaler.pkl&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;artifacts/config.json&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>threshold <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;threshold&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> load_model<span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;artifacts/model.pth&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            input_dim<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span></span>
<span class="line">            device<span class="token operator">=</span>DEVICE</span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> features<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        x_scaled <span class="token operator">=</span> preprocess<span class="token punctuation">(</span>features<span class="token punctuation">,</span> self<span class="token punctuation">.</span>scaler<span class="token punctuation">)</span></span>
<span class="line">        x_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>x_scaled<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            prob <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x_tensor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        is_fraud <span class="token operator">=</span> prob <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>threshold</span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;probability&quot;</span><span class="token punctuation">:</span> prob<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;is_fraud&quot;</span><span class="token punctuation">:</span> is_fraud</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>S·ª≠ d·ª•ng:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> inference<span class="token punctuation">.</span>inference <span class="token keyword">import</span> FraudInference</span>
<span class="line"><span class="token keyword">from</span> inference<span class="token punctuation">.</span>schema <span class="token keyword">import</span> validate_features</span>
<span class="line"></span>
<span class="line">engine <span class="token operator">=</span> FraudInference<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">tx <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;V1&quot;</span><span class="token punctuation">:</span> <span class="token number">1.37855899734127</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;V2&quot;</span><span class="token punctuation">:</span> <span class="token number">1.28938093711056</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;V3&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">5.00424678441137</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token string">&quot;V28&quot;</span><span class="token punctuation">:</span> <span class="token number">0.186636547522687</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;Amount&quot;</span><span class="token punctuation">:</span> <span class="token number">0.76</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">validate_features<span class="token punctuation">(</span>tx<span class="token punctuation">)</span></span>
<span class="line">result <span class="token operator">=</span> engine<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>tx<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="‚ûÑ-deploy-dang-gi" tabindex="-1"><a class="header-anchor" href="#‚ûÑ-deploy-dang-gi"><span>‚ûÑ Deploy d·∫°ng g√¨?</span></a></h4><ul><li><p>Option 1: Batch (offline):</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">CSV ‚Üí inference.py ‚Üí CSV result</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Option 2: REST API (ph·ªï bi·∫øn nh·∫•t):</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Client ‚Üí FastAPI ‚Üí inference.py ‚Üí Response</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-H7UPTZlK.js" defer></script>
  </body>
</html>
