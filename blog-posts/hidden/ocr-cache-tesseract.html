<!doctype html>
<html lang="vi-VN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/vuepress-blog/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,400,500,600,700&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><title>Cáº£i thiá»‡n hiá»‡u nÄƒng Tesseract-OCR báº±ng Cache | Kiáº¿n Thá»©c Tá»« Tráº£i Nghiá»‡m</title><meta name="description" content="Má»™t blog Ä‘Æ°á»£c táº¡o báº±ng VuePress">
    <link rel="preload" href="/vuepress-blog/assets/style-B07U0idc.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-B07U0idc.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-DIj4lqCJ.js"><link rel="modulepreload" href="/vuepress-blog/assets/ocr-cache-tesseract.html-BGwto4eS.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-C9NxyJPS.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CKC8Nd-r.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CZwuoLPQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DZCmhdDb.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-YwMNwuWE.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/fastapi-base-project.html-B4YZPdVW.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/mov-to-mp4-converter.html-CY3hJiFD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-series.html-i0c0AJoW.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tesseract-series.html-BYPQZnrH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/plsql-training-series.html-lirJEiy1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-advanced.html-MKYK0n8C.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-basic.html-p9FKRZ--.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-training-saa-series.html-CFs6Kg6I.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/jenkins.html-BeO_qf9S.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-series.html-DMIQ_vCR.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-deep-learning-and-neural-networks.html-DImj3G14.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-llm.html-BftG7fKk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-nen-tang.html-CJz-0uqI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ai-practice.html-DFqCgONf.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-automation.html-DR4nYg5o.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-cloud-computing.html-B2VbEvhU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-database.html-BkELRkow.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-ec2.html-CkbXo_qH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-gioi-thieu-aws.html-CggP7y-T.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-iam.html-DX2kFsRW.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-monitoring.html-LoTo4ezi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-networking.html-DgW3mK1V.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-practice.html-BqBMXmUp.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-serverless.html-DAa6f1p_.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-storage.html-CQOdXO8-.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-beginner.html-DtrsgxLb.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-intermediate.html-BOaqUC_y.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-shell-script.html-Em9VzQX0.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-accuracy-perfomance.html-Dd0bbLdd.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-gioi-thieu-tesseract.html-C_gkLDzz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-practical.html-DrFa0KFH.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-template-matching.html-BG280XGy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tong-quan.html--8YgopWc.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-training-tesseract.html-BZmH_-op.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-advanced.html-CLsK8_Gp.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-beginner.html-0pPHNxli.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-expert.html-Zo_dggl9.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-intermediate.html-C_oQV5PL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/git-practices.html-BfaarUx_.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CMq2AzJF.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-C-YT6FzL.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CSUKdV4C.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-CAtOWbJP.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-CGIu3wSp.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><img class="vp-site-logo" src="/vuepress-blog/images/logo.png" alt="Kiáº¿n Thá»©c Tá»« Tráº£i Nghiá»‡m"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Kiáº¿n Thá»©c Tá»« Tráº£i Nghiá»‡m</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Chá»§"><!---->Trang Chá»§<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="Dá»± Ãn"><!---->Dá»± Ãn<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="Vá» TÃ´i"><!---->Vá» TÃ´i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">NgÃ´n Ngá»¯</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">NgÃ´n Ngá»¯</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/hidden/ocr-cache-tesseract.html" aria-label="Tiáº¿ng Viá»‡t"><!---->Tiáº¿ng Viá»‡t<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Chá»§"><!---->Trang Chá»§<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="Dá»± Ãn"><!---->Dá»± Ãn<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="Vá» TÃ´i"><!---->Vá» TÃ´i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">NgÃ´n Ngá»¯</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">NgÃ´n Ngá»¯</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/hidden/ocr-cache-tesseract.html" aria-label="Tiáº¿ng Viá»‡t"><!---->Tiáº¿ng Viá»‡t<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="cai-thien-hieu-nang-tesseract-ocr-bang-cache" tabindex="-1"><a class="header-anchor" href="#cai-thien-hieu-nang-tesseract-ocr-bang-cache"><span>Cáº£i thiá»‡n hiá»‡u nÄƒng Tesseract-OCR báº±ng Cache</span></a></h1><p>Trong nhiá»u á»©ng dá»¥ng, dá»¯ liá»‡u OCR láº·p láº¡i thÆ°á»ng xuyÃªn, khiáº¿n viá»‡c gá»i Tesseract nhiá»u láº§n trá»Ÿ nÃªn lÃ£ng phÃ­.</p><p>BÃ i viáº¿t nÃ y giá»›i thiá»‡u cÃ¡ch Ã¡p dá»¥ng cache Ä‘á»ƒ lÆ°u káº¿t quáº£ OCR, trÃ¡nh xá»­ lÃ½ láº¡i áº£nh trÃ¹ng, tá»« Ä‘Ã³ cáº£i thiá»‡n tá»‘c Ä‘á»™, giáº£m táº£i CPU, vÃ  tá»‘i Æ°u há»‡ thá»‘ng nháº­n diá»‡n vÄƒn báº£n.</p><p><a href="#1">1. Giá»›i thiá»‡u</a></p><p><a href="#2">2. Best Practices khi dÃ¹ng cache cho OCR</a></p><p><a href="#3">3. Triá»ƒn khai cache trong OCR vá»›i Tesseract</a></p><p><a name="1"></a></p><h2 id="ğŸ“Œ-1-gioi-thieu" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-1-gioi-thieu"><span>ğŸ“Œ 1. Giá»›i thiá»‡u</span></a></h2><ul><li><p>OCR (Optical Character Recognition) vá»›i Tesseract lÃ  giáº£i phÃ¡p phá»• biáº¿n Ä‘á»ƒ trÃ­ch xuáº¥t vÄƒn báº£n tá»« hÃ¬nh áº£nh.</p></li><li><p>Tuy nhiÃªn, trong thá»±c táº¿ triá»ƒn khai, Ä‘áº·c biá»‡t á»Ÿ cÃ¡c há»‡ thá»‘ng xá»­ lÃ½ áº£nh tá»± Ä‘á»™ng, báº¡n sáº½ nháº­n ra má»™t váº¥n Ä‘á»: áº£nh hoáº·c dá»¯ liá»‡u láº·p láº¡i ráº¥t nhiá»u.</p></li><li><p>VÃ­ dá»¥:</p><ul><li><p>âœ¦ Há»‡ thá»‘ng giÃ¡m sÃ¡t mÃ¡y test trong sáº£n xuáº¥t, mÃ n hÃ¬nh hiá»ƒn thá»‹ káº¿t quáº£ láº·p Ä‘i láº·p láº¡i.</p></li><li><p>âœ¦ Scan form, biÃªn lai, chá»©ng tá»« vá»›i cÃ¹ng má»™t máº«u.</p></li><li><p>âœ¦ Nháº­n diá»‡n sá»‘ serial hoáº·c mÃ£ mÃ¡y chá»‰ thay Ä‘á»•i má»™t vÃ i kÃ½ tá»±.</p></li></ul></li><li><p>âš ï¸ Trong nhá»¯ng tÃ¬nh huá»‘ng nhÆ° váº­y, náº¿u má»—i láº§n Ä‘á»u gá»­i áº£nh vÃ o Tesseract Ä‘á»ƒ OCR, há»‡ thá»‘ng sáº½ pháº£i xá»­ lÃ½ khá»‘i lÆ°á»£ng cÃ´ng viá»‡c náº·ng ná», tá»‘n CPU, vÃ  thá»i gian pháº£n há»“i cháº­m.</p></li></ul><h3 id="_1ï¸âƒ£-giai-phap-cache-bo-nho-Ä‘em" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-giai-phap-cache-bo-nho-Ä‘em"><span>1ï¸âƒ£ Giáº£i phÃ¡p cache (bá»™ nhá»› Ä‘á»‡m)</span></a></h3><ul><li><p>Náº¿u áº£nh Ä‘Ã£ tá»«ng Ä‘Æ°á»£c nháº­n diá»‡n, ta cÃ³ thá»ƒ lÆ°u láº¡i káº¿t quáº£.</p></li><li><p>Khi gáº·p láº¡i áº£nh giá»‘ng há»‡t, chá»‰ cáº§n láº¥y káº¿t quáº£ tá»« cache thay vÃ¬ cháº¡y OCR láº¡i.</p></li></ul><h4 id="âœ…-uu-Ä‘iem" tabindex="-1"><a class="header-anchor" href="#âœ…-uu-Ä‘iem"><span>âœ… Æ¯u Ä‘iá»ƒm:</span></a></h4><ul><li><p>â€ Giáº£m sá»‘ láº§n gá»i Tesseract.</p></li><li><p>â TÄƒng tá»‘c Ä‘á»™ xá»­ lÃ½.</p></li><li><p>â‚ Giáº£m táº£i CPU, tiáº¿t kiá»‡m tÃ i nguyÃªn.</p></li></ul><h3 id="_2ï¸âƒ£-co-che-cache" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-co-che-cache"><span>2ï¸âƒ£ CÆ¡ cháº¿ cache</span></a></h3><ul><li><p>â€ Má»™t áº£nh â†’ má»™t káº¿t quáº£ OCR.</p></li><li><p>â áº¢nh Ä‘Æ°á»£c nháº­n diá»‡n â†’ lÆ°u káº¿t quáº£ vÃ o cache.</p></li><li><p>â‚ Khi gáº·p láº¡i áº£nh giá»‘ng há»‡t â†’ láº¥y tá»« cache thay vÃ¬ OCR láº¡i.</p></li></ul><h4 id="ğŸ”¥-cach-nhan-dien-anh-trung" tabindex="-1"><a class="header-anchor" href="#ğŸ”¥-cach-nhan-dien-anh-trung"><span>ğŸ”¥ CÃ¡ch nháº­n diá»‡n áº£nh trÃ¹ng:</span></a></h4><ul><li>Hash (MD5, SHA256) trÃªn dá»¯ liá»‡u áº£nh.</li></ul><h3 id="_3ï¸âƒ£-cac-loai-cache" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-cac-loai-cache"><span>3ï¸âƒ£ CÃ¡c loáº¡i cache</span></a></h3><ul><li><p>CÃ³ thá»ƒ cache theo nhiá»u má»©c:</p><ul><li><p>â¶ In-memory cache: LÆ°u vÃ o RAM</p><ul><li>âœ”ï¸ Tá»‘c Ä‘á»™ truy cáº­p cá»±c nhanh.</li><li>âœ”ï¸ PhÃ¹ há»£p khi cáº§n OCR realtime.</li><li>âœ”ï¸ KhÃ´ng Ä‘á»ƒ láº¡i file rÃ¡c trÃªn á»• cá»©ng.</li><li>âŒ Máº¥t cache khi restart process</li><li>âŒ Bá»‹ giá»›i háº¡n dung lÆ°á»£ng theo RAM (vÃ­ dá»¥ vÃ i trÄƒm MB hoáº·c vÃ i GB tÃ¹y server).</li></ul></li><li><p>â· Disk cache: LÆ°u ra á»• cá»©ng</p><ul><li>âœ”ï¸ Dung lÆ°á»£ng lá»›n, cÃ³ thá»ƒ lÆ°u cache hÃ ng chá»¥c GB.</li><li>âœ”ï¸ Cache bá»n vá»¯ng: restart process/mÃ¡y váº«n giá»¯ Ä‘Æ°á»£c.</li><li>âœ”ï¸ PhÃ¹ há»£p cho dá»¯ liá»‡u OCR láº·p láº¡i nhiá»u ngÃ y.</li><li>âŒ Cháº­m hÆ¡n RAM má»™t chÃºt.</li><li>âŒ CÃ³ thá»ƒ gÃ¢y hao mÃ²n SSD náº¿u ghi/xÃ³a liÃªn tá»¥c.</li><li>âŒ Cáº§n cÆ¡ cháº¿ dá»n dáº¹p (TTL, LRU).</li></ul></li><li><p>â¸ Káº¿t há»£p (Hybrid): DÃ¹ng memory cho áº£nh má»›i nháº¥t, disk cho áº£nh lÃ¢u hÆ¡n.</p></li></ul></li></ul><h3 id="_4ï¸âƒ£-gioi-han-so-luong-cache" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-gioi-han-so-luong-cache"><span>4ï¸âƒ£ Giá»›i háº¡n sá»‘ lÆ°á»£ng cache</span></a></h3><ul><li><p>â— Cache khÃ´ng nÃªn â€œvÃ´ háº¡nâ€. Viá»‡c giá»›i háº¡n sá»‘ lÆ°á»£ng cache giÃºp trÃ¡nh viá»‡c ngá»‘n háº¿t RAM/á»• cá»©ng vÃ  giá»¯ cho há»‡ thá»‘ng á»•n Ä‘á»‹nh.</p></li><li><p>â— Viá»‡c giá»›i háº¡n sá»‘ lÆ°á»£ng cache sáº½ trÃ¡nh tÃ¬nh tráº¡ng phÃ¬nh ra vÃ  gÃ¢y tá»‘n bá»™ nhá»› hoáº·c dung lÆ°á»£ng á»• Ä‘Ä©a, nháº¥t lÃ  khi áº£nh OCR nhiá»u vÃ  kÃ­ch thÆ°á»›c lá»›n.</p></li><li><p>â— Má»™t sá»‘ cÃ¡ch giá»›i háº¡n há»£p lÃ½:</p></li></ul><h4 id="â¶-gioi-han-theo-so-luong-muc-entries" tabindex="-1"><a class="header-anchor" href="#â¶-gioi-han-theo-so-luong-muc-entries"><span>â¶ Giá»›i háº¡n theo sá»‘ lÆ°á»£ng má»¥c (entries)</span></a></h4><ul><li><p>âœ¦ Chá»‰ giá»¯ N áº£nh/vÃ¹ng gáº§n nháº¥t (vÃ­ dá»¥ 500 hoáº·c 1000 má»¥c).</p></li><li><p>âœ¦ Khi cache Ä‘áº§y â†’ xÃ³a entry cÅ© nháº¥t (LRU - Least Recently Used).</p><ul><li>âœ§ CÃ³ thá»ƒ chá»n chá»‰ xÃ³a 1 entry cÅ© nháº¥t hoáº·c nhiá»u entries cÅ© cÃ¹ng lÃºc (vÃ­ dá»¥ 20% entries cÅ© nháº¥t).</li></ul></li><li><p>âœ¦ DÃ¹ng collections.OrderedDict hoáº·c thÆ° viá»‡n functools.lru_cache (cho RAM) Ä‘á»ƒ tá»± Ä‘á»™ng cÆ¡ cháº¿ LRU hoáº·c tá»± viáº¿t logic thá»§ cÃ´ng.</p></li></ul><h4 id="â·-gioi-han-theo-dung-luong" tabindex="-1"><a class="header-anchor" href="#â·-gioi-han-theo-dung-luong"><span>â· Giá»›i háº¡n theo dung lÆ°á»£ng</span></a></h4><ul><li><p>âœ¦ VÃ­ dá»¥ tá»•ng kÃ­ch thÆ°á»›c file cache khÃ´ng vÆ°á»£t quÃ¡ 100MB.</p></li><li><p>âœ¦ Khi vÆ°á»£t ngÆ°á»¡ng â†’ xÃ³a cÃ¡c file cÅ© nháº¥t.</p></li></ul><h4 id="â¸-gioi-han-theo-thoi-gian-ton-tai-ttl" tabindex="-1"><a class="header-anchor" href="#â¸-gioi-han-theo-thoi-gian-ton-tai-ttl"><span>â¸ Giá»›i háº¡n theo thá»i gian tá»“n táº¡i (TTL)</span></a></h4><ul><li>âœ¦ Má»—i entry cache chá»‰ tá»“n táº¡i trong X phÃºt/giá» (vÃ­ dá»¥ 10 phÃºt).</li></ul><h4 id="â¹-ket-hop-nhieu-tieu-chi" tabindex="-1"><a class="header-anchor" href="#â¹-ket-hop-nhieu-tieu-chi"><span>â¹ Káº¿t há»£p nhiá»u tiÃªu chÃ­</span></a></h4><ul><li>âœ¦ VÃ­ dá»¥: giá»›i háº¡n tá»‘i Ä‘a 1000 entry vÃ  TTL = 10 phÃºt â†’ vá»«a trÃ¡nh Ä‘áº§y bá»™ nhá»›, vá»«a Ä‘áº£m báº£o dá»¯ liá»‡u khÃ´ng quÃ¡ cÅ©.</li></ul><p><a name="2"></a></p><h2 id="ğŸ“Œ-2-best-practices-khi-dung-cache-cho-ocr" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-2-best-practices-khi-dung-cache-cho-ocr"><span>ğŸ“Œ 2. Best Practices khi dÃ¹ng cache cho OCR</span></a></h2><ul><li>CÃ¡c chiáº¿n lÆ°á»£c sá»­ dá»¥ng cache hiá»ƒu quáº£:</li></ul><h3 id="_1ï¸âƒ£-hash-tren-anh-goc-hay-sau-tien-xu-ly" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-hash-tren-anh-goc-hay-sau-tien-xu-ly"><span>1ï¸âƒ£ Hash trÃªn áº£nh gá»‘c hay sau tiá»n xá»­ lÃ½?</span></a></h3><ul><li>Viá»‡c hash trÃªn áº£nh gá»‘c hay áº£nh Ä‘Ã£ qua tiá»n xá»­ lÃ½ sáº½ áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n hiá»‡u quáº£ cache.</li></ul><h4 id="â¶-hash-tren-anh-goc" tabindex="-1"><a class="header-anchor" href="#â¶-hash-tren-anh-goc"><span>â¶ Hash trÃªn áº£nh gá»‘c</span></a></h4><ul><li><p>âœ”ï¸ Æ¯u Ä‘iá»ƒm:</p><ul><li><p>âœ§ Dá»… lÃ m, chá»‰ cáº§n Ä‘á»c áº£nh vÃ  bÄƒm ngay.</p></li><li><p>âœ§ KhÃ´ng cáº§n qua bÆ°á»›c tiá»n xá»­ lÃ½ â†’ tá»‘i Æ°u hiá»‡u nÄƒng.</p></li></ul></li><li><p>âŒ NhÆ°á»£c Ä‘iá»ƒm:</p><ul><li>âœ§ Hai áº£nh trÃ´ng â€œgiá»‘ng nhauâ€ nhÆ°ng chá»‰ khÃ¡c ráº¥t nhá» (vÃ­ dá»¥ khÃ¡c DPI, khÃ¡c má»™t pixel do noise) â†’ hash sáº½ khÃ¡c hoÃ n toÃ n â†’ cache khÃ´ng hit.</li></ul></li></ul><h4 id="â·-hash-sau-tien-xu-ly" tabindex="-1"><a class="header-anchor" href="#â·-hash-sau-tien-xu-ly"><span>â· Hash sau tiá»n xá»­ lÃ½</span></a></h4><ul><li><p>âœ”ï¸ Æ¯u Ä‘iá»ƒm:</p><ul><li>âœ§ Loáº¡i bá» sá»± khÃ¡c biá»‡t khÃ´ng quan trá»ng (noise, Ä‘á»™ sÃ¡ng, DPIâ€¦) â†’ cache hit cao hÆ¡n.</li></ul></li><li><p>âŒ NhÆ°á»£c Ä‘iá»ƒm:</p><ul><li><p>âœ§ Tá»‘n thÃªm thá»i gian tiá»n xá»­ lÃ½ trÆ°á»›c khi hash.</p></li><li><p>âœ§ Náº¿u thay Ä‘á»•i thuáº­t toÃ¡n xá»­ lÃ½ (vÃ­ dá»¥ threshold khÃ¡c) â†’ hash khÃ¡c â†’ cache cÅ© khÃ´ng dÃ¹ng láº¡i Ä‘Æ°á»£c.</p></li></ul></li></ul><h4 id="ğŸ’¡-kinh-nghiem" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-kinh-nghiem"><span>ğŸ’¡ Kinh nghiá»‡m:</span></a></h4><ul><li><p>âœ¦ Náº¿u áº£nh á»•n Ä‘á»‹nh, Ã­t nhiá»…u â†’ hash trÃªn áº£nh gá»‘c Ä‘á»ƒ tiáº¿t kiá»‡m cÃ´ng sá»©c.</p></li><li><p>âœ¦ Náº¿u chá»‰ OCR text nhá», fixed-layout (nhÆ° mÃ¡y test, form scan) â†’ nÃªn hash trÃªn áº£nh Ä‘Ã£ tiá»n xá»­ lÃ½ (grayscale + threshold).</p></li></ul><h3 id="_2ï¸âƒ£-chon-ram-cache-hay-disk-cache" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-chon-ram-cache-hay-disk-cache"><span>2ï¸âƒ£ Chá»n RAM cache hay Disk cache?</span></a></h3><h4 id="â¶-ram-cache" tabindex="-1"><a class="header-anchor" href="#â¶-ram-cache"><span>â¶ RAM cache</span></a></h4><ul><li><p>DÃ¹ng khi:</p><ul><li><p>âœ§ áº¢nh OCR nhá»/gá»n.</p></li><li><p>âœ§ á»¨ng dá»¥ng yÃªu cáº§u tá»‘c Ä‘á»™ cao.</p></li><li><p>âœ§ Cache chá»‰ cáº§n sá»‘ng trong session (vÃ­ dá»¥ má»™t service OCR cháº¡y vÃ i giá» rá»“i reset).</p></li></ul></li></ul><h4 id="â·-disk-cache" tabindex="-1"><a class="header-anchor" href="#â·-disk-cache"><span>â· Disk cache</span></a></h4><ul><li><p>DÃ¹ng khi:</p><ul><li><p>âœ§ OCR áº£nh lá»›n, nhiá»u file, dá»¯ liá»‡u láº·p láº¡i qua nhiá»u ngÃ y.</p></li><li><p>âœ§ Há»‡ thá»‘ng cháº¡y dÃ i háº¡n, cáº§n cache bá»n vá»¯ng.</p></li><li><p>âœ§ Æ¯u tiÃªn tiáº¿t kiá»‡m RAM.</p></li></ul></li></ul><h4 id="â¸-ket-hop-hybrid-ram-disk" tabindex="-1"><a class="header-anchor" href="#â¸-ket-hop-hybrid-ram-disk"><span>â¸ Káº¿t há»£p Hybrid (RAM + Disk)</span></a></h4><ul><li><p>âœ§ ÄÃ¢y lÃ  lá»±a chá»n cÃ¢n báº±ng nháº¥t cho háº§u háº¿t cÃ¡c há»‡ thá»‘ng OCR production.</p></li><li><p>âœ§ ThÆ° viá»‡n nhÆ° diskcache há»— trá»£ sáºµn cÆ¡ cháº¿ nÃ y.</p></li></ul><h4 id="âš ï¸-luu-y" tabindex="-1"><a class="header-anchor" href="#âš ï¸-luu-y"><span>âš ï¸ LÆ°u Ã½:</span></a></h4><ul><li><p>TrÆ°á»ng há»£p OCR Ä‘ang dÃ¹ng multiprocessing, má»—i worker process sáº½ cÃ³ má»™t instance ocr_cache riÃªng biá»‡t.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">ocr_cache <span class="token operator">=</span> OCRCacheManager<span class="token punctuation">(</span>max_size<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>Process 1 set cache â†’ Process 2 khÃ´ng tháº¥y cache cá»§a Process 1. ÄÃ³ lÃ  lÃ½ do khi dÃ¹ng RAM cache sáº½ khÃ´ng chia sáº» dá»¯ liá»‡u Ä‘Ã£ lÆ°u trÆ°á»›c Ä‘Ã³ trong cache giá»¯a cÃ¡c process Ä‘Æ°á»£c cho nhau.</li></ul></li><li><p>ğŸ‘‰ <strong>Giáº£i phÃ¡p:</strong> Shared cache giá»¯a processes</p><ul><li><p>â€ Option A - Redis Cache / Memcached:</p><ul><li><p>âœ¦ Náº¿u há»‡ thá»‘ng OCR phÃ¢n tÃ¡n hoáº·c nhiá»u mÃ¡y cháº¡y song song, dÃ¹ng Redis hoáº·c Memcached Ä‘á»ƒ lÆ°u cache.</p></li><li><p>âœ”ï¸ Æ¯u Ä‘iá»ƒm: Ráº¥t nhanh, há»— trá»£ multi-process vÃ  multi-machine.</p></li><li><p>âŒ NhÆ°á»£c Ä‘iá»ƒm: Pháº£i cÃ i thÃªm dá»‹ch vá»¥.</p></li></ul></li><li><p>â Option B - File-based shared cache (disk cache):</p><ul><li><p>âœ¦ Má»—i khi OCR xong, lÆ°u káº¿t quáº£ vÃ o file .json hoáº·c .pickle trÃªn disk, Ä‘áº·t key theo hash áº£nh.</p></li><li><p>âœ¦ Khi process khÃ¡c OCR cÃ¹ng áº£nh, nÃ³ sáº½ Ä‘á»c file cache thay vÃ¬ OCR láº¡i.</p></li></ul></li><li><p>ğŸ’¡ <strong>Kinh nghiá»‡m</strong>:</p><ul><li><p>âœ¦ Náº¿u OCR chá»‰ cháº¡y trÃªn má»™t mÃ¡y, vÃ  file áº£nh nhá» â†’ <strong>diskcache</strong> lÃ  lá»±a chá»n ngon: dá»… triá»ƒn khai, tá»± Ä‘á»™ng thread-safe, vÃ  khÃ´ng bá»‹ máº¥t cache khi process cháº¿t.</p><ul><li>âœ”ï¸ LÃ  Hybrid cache (RAM + Disk), nhÆ°ng thiÃªn vá» Disk cache cÃ³ tÄƒng tá»‘c RAM.</li><li>âœ”ï¸ Chá»‰ cáº§n cÃ i Python package, khÃ´ng cáº§n service bÃªn ngoÃ i.</li><li>âœ”ï¸ Dá»… triá»ƒn khai hÆ¡n, khÃ´ng pháº£i lo cáº¥u hÃ¬nh network, user, auth nhÆ° Redis.</li><li>âœ”ï¸ CÃ³ thá»ƒ tá»± Ä‘á»™ng xÃ³a entries cÅ© khi vÆ°á»£t quÃ¡ size_limit.</li><li>âœ”ï¸ CÃ³ cÆ¡ cháº¿ máº·c Ä‘á»‹nh lÃ  Least Recently Used (LRU), tá»©c lÃ  key nÃ o lÃ¢u khÃ´ng Ä‘Æ°á»£c truy cáº­p sáº½ bá»‹ xÃ³a trÆ°á»›c.</li></ul></li><li><p>âœ¦ Náº¿u OCR cháº¡y phÃ¢n tÃ¡n nhiá»u mÃ¡y â†’ dÃ¹ng Redis.</p></li></ul></li></ul></li></ul><h3 id="_3ï¸âƒ£-nen-gioi-han-so-luong-cache-theo-cach-nao" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-nen-gioi-han-so-luong-cache-theo-cach-nao"><span>3ï¸âƒ£ NÃªn giá»›i háº¡n sá»‘ lÆ°á»£ng cache theo cÃ¡ch nÃ o?</span></a></h3><ul><li><p>Cache khÃ´ng nÃªn â€œvÃ´ háº¡nâ€. Viá»‡c giá»›i háº¡n sá»‘ lÆ°á»£ng cache giÃºp trÃ¡nh viá»‡c ngá»‘n háº¿t RAM/á»• cá»©ng vÃ  giá»¯ cho há»‡ thá»‘ng á»•n Ä‘á»‹nh.</p></li><li><p>âœ”ï¸ Náº¿u dÃ¹ng RAM cache â†’ Giá»›i háº¡n theo sá»‘ lÆ°á»£ng má»¥c (entries)</p></li><li><p>âœ”ï¸ Náº¿u dÃ¹ng Disk cache â†’ Giá»›i háº¡n theo dung lÆ°á»£ng báº±ng (size_limit) hoáº·c TTL (tá»± Ä‘á»™ng xoÃ¡ cache cÅ© sau X ngÃ y).</p></li><li><p>âœ”ï¸ Náº¿u dá»¯ liá»‡u OCR thay Ä‘á»•i theo ngÃ y/phiÃªn báº£n â†’ Giá»›i háº¡n theo TTL.</p></li></ul><h4 id="âš ï¸-kinh-nghiem" tabindex="-1"><a class="header-anchor" href="#âš ï¸-kinh-nghiem"><span>âš ï¸ Kinh nghiá»‡m:</span></a></h4><ul><li><p>âœ¦ NÃªn log láº¡i cache hit/miss Ä‘á»ƒ Ä‘iá»u chá»‰nh.</p></li><li><p>âœ¦ VÃ­ dá»¥ log tháº¥y Ä‘a sá»‘ truy váº¥n khÃ´ng hit cache â†’ cache khÃ´ng cÃ²n â€œhiá»‡u quáº£â€. LÃºc nÃ y nÃªn Ä‘iá»u chá»‰nh giá»›i háº¡n cache Ä‘á»ƒ trÃ¡nh lÆ°u thá»«a.</p></li></ul><h3 id="_4ï¸âƒ£-trien-khai-cache-hieu-qua-trong-project" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-trien-khai-cache-hieu-qua-trong-project"><span>4ï¸âƒ£ Triá»ƒn khai cache hiá»ƒu quáº£ trong project?</span></a></h3><ul><li><p>NÃªn táº¡o riÃªng <code>cache_manager.py</code> Ä‘á»ƒ quáº£n lÃ½ cache vÃ¬ nhá»¯ng lÃ½ do sau:</p><ul><li><p>âœ”ï¸ Single Responsibility:Â PhÃ¢n tÃ¡n,Â <code>cache_manager.py</code> sáº½ chá»‰Â táº­p trung vÃ o cache. OCR sáº½ táº­p trung file khÃ¡c (vÃ­ dá»¥: <code>ocr_worker.py</code>).</p></li><li><p>âœ”ï¸ Reusable: CÃ³ thá»ƒ dÃ¹ng cache cho cÃ¡c module khÃ¡c.</p></li><li><p>âœ”ï¸ Testable: Dá»… unit test cache logic riÃªng biá»‡t.</p></li><li><p>âœ”ï¸ Maintainable: Dá»… modify cache strategy mÃ  khÃ´ng áº£nh hÆ°á»Ÿng OCR logic.</p></li><li><p>âœ”ï¸ Salable: Dá»… má»Ÿ rá»™ng cache (Redis, file-based cache...).</p></li></ul></li></ul><p><a name="3"></a></p><h2 id="ğŸ“Œ-3-trien-khai-cache-trong-ocr-voi-tesseract" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-3-trien-khai-cache-trong-ocr-voi-tesseract"><span>ğŸ“Œ 3. Triá»ƒn khai cache trong OCR vá»›i Tesseract</span></a></h2><h3 id="_1ï¸âƒ£-tao-class-quan-ly-cache" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-tao-class-quan-ly-cache"><span>1ï¸âƒ£ Táº¡o class quáº£n lÃ½ cache</span></a></h3><h4 id="â¶-ram-cache-1" tabindex="-1"><a class="header-anchor" href="#â¶-ram-cache-1"><span>â¶ Ram cache</span></a></h4><ul><li><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># cache_manager.py</span></span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CacheManager</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_size<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>max_size <span class="token operator">=</span> max_size</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="â·-disk-cache-1" tabindex="-1"><a class="header-anchor" href="#â·-disk-cache-1"><span>â· Disk cache</span></a></h4><ul><li><p>ThÃªm logic load cache tá»« file JSON vÃ  lÆ°u cache vÃ i file khi táº¯t tool.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># cache_manager.py</span></span>
<span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CacheManager</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cache_file<span class="token operator">=</span><span class="token string">&quot;ocr_cache.json&quot;</span><span class="token punctuation">,</span> max_items<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache_file <span class="token operator">=</span> cache_file</span>
<span class="line">        self<span class="token punctuation">.</span>max_size <span class="token operator">=</span> max_items</span>
<span class="line">        self<span class="token punctuation">.</span>cache <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># LÆ°u káº¿t quáº£ OCR</span></span>
<span class="line"></span>
<span class="line">        self<span class="token punctuation">.</span>_load_cache<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_load_cache</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&quot;&quot;&quot;Load cache tá»« file JSON.&quot;&quot;&quot;</span></span>
<span class="line">        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cache_file<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cache_file<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">                    data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">                <span class="token comment"># Load theo Ä‘Ãºng thá»© tá»± FIFO</span></span>
<span class="line">                self<span class="token punctuation">.</span>cache <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[CacheManager] Lá»—i khi load cache: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">                self<span class="token punctuation">.</span>cache <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">save_cache</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&quot;&quot;&quot;LÆ°u cache ra file JSON.&quot;&quot;&quot;</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cache_file<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">                json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cache<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[CacheManager] Lá»—i khi lÆ°u cache: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2ï¸âƒ£-sinh-key-duy-nhat-cho-anh" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-sinh-key-duy-nhat-cho-anh"><span>2ï¸âƒ£ Sinh key duy nháº¥t cho áº£nh</span></a></h3><ul><li><p>Hash ná»™i dung áº£nh sau preprocess (MD5, SHA1).</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> hashlib</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">_hash_image_bytes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>img<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">_get_cache_key</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> extra_params<span class="token punctuation">:</span> Tuple <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">    img_hash <span class="token operator">=</span> self<span class="token punctuation">.</span>_hash_image_bytes<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Náº¿u cáº§n gáº¯n thÃªm tham sá»‘ vÃ o key Ä‘á»ƒ phÃ¢n biá»‡t cÃ¡c nhÃ³m</span></span>
<span class="line">    <span class="token keyword">if</span> extra_params<span class="token punctuation">:</span></span>
<span class="line">        params_str <span class="token operator">=</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> extra_params<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>img_hash<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>params_str<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">    <span class="token keyword">return</span> img_hash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3ï¸âƒ£-tao-cac-ham-get-va-set-ket-qua-ocr-theo-key" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-tao-cac-ham-get-va-set-ket-qua-ocr-theo-key"><span>3ï¸âƒ£ Táº¡o cÃ¡c hÃ m get vÃ  set káº¿t quáº£ OCR theo key</span></a></h3><ul><li>Cache Ä‘Æ°á»£c lÆ°u dÆ°á»›i dáº¡ng dictionary (hash â†’ text_result).</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Tráº£ vá» káº¿t quáº£ OCR tá»« cache (náº¿u cÃ³)&quot;&quot;&quot;</span></span>
<span class="line">    key <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_cache_key<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Náº¿u key Ä‘Ã£ tá»“n táº¡i thÃ¬ move lÃªn Ä‘áº§u Ä‘á»ƒ Ä‘Ã¡nh dáº¥u &quot;vá»«a dÃ¹ng&quot;</span></span>
<span class="line">    <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>move_to_end<span class="token punctuation">(</span>key<span class="token punctuation">,</span> last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> image<span class="token punctuation">,</span> ocr_result<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;LÆ°u káº¿t quáº£ OCR vÃ o cache.&quot;&quot;&quot;</span></span>
<span class="line">    key <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_cache_key<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Náº¿u key Ä‘Ã£ tá»“n táº¡i thÃ¬ cáº­p nháº­t &amp; move lÃªn Ä‘áº§u</span></span>
<span class="line">    <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>move_to_end<span class="token punctuation">(</span>key<span class="token punctuation">,</span> last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> ocr_result</span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Náº¿u cache Ä‘áº§y â†’ xÃ³a pháº§n tá»­ cuá»‘i (Ã­t dÃ¹ng nháº¥t)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>max_size<span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span>last<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># ThÃªm entry má»›i vÃ o Ä‘áº§u náº¿u key chÆ°a tá»“n táº¡i</span></span>
<span class="line">    self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> ocr_result</span>
<span class="line">    self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>move_to_end<span class="token punctuation">(</span>key<span class="token punctuation">,</span> last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ï¸âƒ£-don-cache" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-don-cache"><span>4ï¸âƒ£ Dá»n cache</span></a></h3><ul><li><p>DÃ¹ng khi:</p><ul><li><p>â€ Khi muá»‘n giáº£i phÃ³ng RAM thá»§ cÃ´ng.</p></li><li><p>â Khi thay Ä‘á»•i cáº¥u hÃ¬nh OCR.</p></li><li><p>â‚ Khi nháº­n tÃ­n hiá»‡u reset tá»« tool</p></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">clear</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;XÃ³a toÃ n bá»™ cache.&quot;&quot;&quot;</span></span>
<span class="line">    self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_5ï¸âƒ£-su-dung-trong-ocr" tabindex="-1"><a class="header-anchor" href="#_5ï¸âƒ£-su-dung-trong-ocr"><span>5ï¸âƒ£ Sá»­ dá»¥ng trong OCR</span></a></h3><ul><li><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># ocr_worker.py</span></span>
<span class="line"><span class="token keyword">from</span> cache_manager <span class="token keyword">import</span> OCRCacheManager</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Khá»Ÿi táº¡o cache (giá»›i háº¡n 500 entry)</span></span>
<span class="line">ocr_cache <span class="token operator">=</span> OCRCacheManager<span class="token punctuation">(</span>max_size<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">ocr_image</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Check cache</span></span>
<span class="line">    result <span class="token operator">=</span> ocr_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;âœ… OCR tá»« cache&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> result</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># OCR vá»›i Tesseract</span></span>
<span class="line">    result <span class="token operator">=</span> run_tesseract<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># LÆ°u vÃ o cache</span></span>
<span class="line">    ocr_cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> result<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> result</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Náº¿u dÃ¹ng Disk cache, lÆ°u cache vÃ o file JSON khi táº¯t tool</span></span>
<span class="line">ocr_cache<span class="token punctuation">.</span>save_cache<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="ğŸ”¥-vi-du-ket-hop-hybrid-ram-disk-voi-thu-vien-diskcache" tabindex="-1"><a class="header-anchor" href="#ğŸ”¥-vi-du-ket-hop-hybrid-ram-disk-voi-thu-vien-diskcache"><span>ğŸ”¥ VÃ­ dá»¥ káº¿t há»£p Hybrid (RAM + Disk) vá»›i thÆ° viá»‡n diskcache</span></a></h3><h4 id="â¶-cai-diskcache" tabindex="-1"><a class="header-anchor" href="#â¶-cai-diskcache"><span>â¶ CÃ i diskcache</span></a></h4><ul><li><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pip <span class="token function">install</span> diskcache</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="â·-trien-khai-trong-cache-manager-py" tabindex="-1"><a class="header-anchor" href="#â·-trien-khai-trong-cache-manager-py"><span>â· Triá»ƒn khai trong <code>cache_manager.py</code></span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> hashlib</span>
<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional</span>
<span class="line"><span class="token keyword">import</span> diskcache <span class="token keyword">as</span> dc</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> utils<span class="token punctuation">.</span>common <span class="token keyword">import</span> get_base_dir</span>
<span class="line"><span class="token keyword">from</span> utils<span class="token punctuation">.</span>logger <span class="token keyword">import</span> setup_logger</span>
<span class="line"></span>
<span class="line">logger <span class="token operator">=</span> setup_logger<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">OCRCacheManager</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        base_dir <span class="token operator">=</span> get_base_dir<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        cache_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">&quot;ocr_cache&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>cache_path<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>cache <span class="token operator">=</span> dc<span class="token punctuation">.</span>Cache<span class="token punctuation">(</span></span>
<span class="line">            directory<span class="token operator">=</span>cache_path<span class="token punctuation">,</span></span>
<span class="line">            size_limit<span class="token operator">=</span>max_size <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span></span>
<span class="line">            timeout<span class="token operator">=</span><span class="token number">1.0</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_get_image_hash</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>img<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_get_cache_key</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> stage<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">        img_hash <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_image_hash<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>stage<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>img_hash<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> stage<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span></span>
<span class="line">        key <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_cache_key<span class="token punctuation">(</span>img<span class="token punctuation">,</span> stage<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            result <span class="token operator">=</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">return</span> result</span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Cache get error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> stage<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> ocr_result<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        key <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_cache_key<span class="token punctuation">(</span>img<span class="token punctuation">,</span> stage<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> ocr_result<span class="token punctuation">,</span> expire<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Cache set error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">clear</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Cache clear error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Cache close error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="â¸-giai-thich" tabindex="-1"><a class="header-anchor" href="#â¸-giai-thich"><span>â¸ Giáº£i thÃ­ch</span></a></h4><ul><li><p>âœ¦ Triá»ƒn khai diskcache báº£n cháº¥t cÃ¡ch dÃ¹ng gáº§n nhÆ° khÃ´ng Ä‘á»•i.</p></li><li><p>âœ¦ KhÃ¡c biá»‡t lá»›n nháº¥t chÃºng ta tháº¥y Ä‘Æ°á»£c náº±m á»Ÿ:</p><ul><li><p>âœ§ DiskCache tá»± quáº£n lÃ½ eviction policy (xÃ³a bá»›t entries cÅ© khi vÆ°á»£t quÃ¡ size_limit hoáº·c cull_limit).</p></li><li><p>âœ§ DiskCache lo giÃ¹m chuyá»‡n dá»n rÃ¡c, lock, share dá»¯ liá»‡u giá»¯a processes.</p></li></ul></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-DIj4lqCJ.js" defer></script>
  </body>
</html>
