<!doctype html>
<html lang="vi-VN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/vuepress-blog/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,400,500,600,700&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><title>PL/SQL n√¢ng cao | Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám</title><meta name="description" content="M·ªôt blog ƒë∆∞·ª£c t·∫°o b·∫±ng VuePress">
    <link rel="preload" href="/vuepress-blog/assets/style-Ca62376s.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-Ca62376s.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-DOb7ZgK3.js"><link rel="modulepreload" href="/vuepress-blog/assets/oracle-plsql-advanced.html-DfXSUoc7.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-DPD7qHUQ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DHq09lYF.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-JauqA18g.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DIxyWOuT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-vQctuU0B.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/fastapi-base-project.html-BtC6eoWC.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-gioi-thieu-tesseract.html-DN6M0IXi.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tong-quan.html-Bkq-z94K.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-beginner.html-BhjIRkXw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-expert.html-B6hLDwnr.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-intermediate.html-BuVAPPXw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-advanced.html-BUSth7Xg.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-basic.html-2XLmiKyw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-cloud-computing.html-tXXEBLy6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-ec2.html-DEOryarN.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-gioi-thieu-aws.html-D1GgHZYG.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-iam.html-YlsVWu5Q.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-beginner.html-cgFT3_Lg.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-intermediate.html-C9v7KPMR.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-shell-script.html-DyoKgLot.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tesseract-series.html-Bsl_TlKy.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/plsql-training-series.html-9beeaK8J.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-BGRAY6uO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-D8BLZnNk.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DJJRWpUc.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-BdkW5WyC.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-BOsVlekt.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><img class="vp-site-logo" src="/vuepress-blog/images/logo.png" alt="Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Ki·∫øn Th·ª©c T·ª´ Tr·∫£i Nghi·ªám</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Ch·ªß"><!---->Trang Ch·ªß<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="D·ª± √Ån"><!---->D·ª± √Ån<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="V·ªÅ T√¥i"><!---->V·ªÅ T√¥i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/back-end/oracle-plsql-advanced.html" aria-label="Ti·∫øng Vi·ªát"><!---->Ti·∫øng Vi·ªát<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Ch·ªß"><!---->Trang Ch·ªß<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="D·ª± √Ån"><!---->D·ª± √Ån<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="V·ªÅ T√¥i"><!---->V·ªÅ T√¥i<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ng√¥n Ng·ªØ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/back-end/oracle-plsql-advanced.html" aria-label="Ti·∫øng Vi·ªát"><!---->Ti·∫øng Vi·ªát<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="pl-sql-nang-cao" tabindex="-1"><a class="header-anchor" href="#pl-sql-nang-cao"><span>PL/SQL n√¢ng cao</span></a></h1><p><a href="#1">1. Transactions</a></p><p><a href="#2">2. Dynamic SQL</a></p><p><a href="#3">3. Collection v√† Record</a></p><p><a href="#4">4. Bulk Processing</a></p><p><a name="1"></a></p><h2 id="üìå-1-transactions-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#üìå-1-transactions-trong-pl-sql"><span>üìå 1. Transactions trong PL/SQL</span></a></h2><p>Transaction l√† m·ªôt t·∫≠p h·ª£p c√°c c√¢u l·ªánh SQL ƒë∆∞·ª£c th·ª±c thi nh∆∞ m·ªôt ƒë∆°n v·ªã c√¥ng vi·ªác.</p><p>V·ªÅ t√≠nh ch·∫•t c·ªßa Transaction th√¨ ch·∫Øc s·∫Ω kh√¥ng c·∫ßn ƒë·ªÅ c·∫≠p l·∫°i.</p><p>Trong PL/SQL, m·ªôt transaction b·∫Øt ƒë·∫ßu t·ª± ƒë·ªông khi th·ª±c hi·ªán b·∫•t k·ª≥ c√¢u l·ªánh DML (INSERT, UPDATE, DELETE).</p><h3 id="üîπ-cac-lenh-ƒëieu-khien-transaction-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#üîπ-cac-lenh-ƒëieu-khien-transaction-trong-pl-sql"><span>üîπ C√°c l·ªánh ƒëi·ªÅu khi·ªÉn Transaction trong PL/SQL</span></a></h3><table><thead><tr><th style="text-align:center;">L·ªánh</th><th style="text-align:center;">Ch·ª©c nƒÉng</th></tr></thead><tbody><tr><td style="text-align:center;">COMMIT</td><td style="text-align:center;">X√°c nh·∫≠n transaction, l∆∞u thay ƒë·ªïi v√†o DB</td></tr><tr><td style="text-align:center;">ROLLBACK</td><td style="text-align:center;">H·ªßy b·ªè transaction, kh√¥i ph·ª•c tr·∫°ng th√°i tr∆∞·ªõc ƒë√≥</td></tr><tr><td style="text-align:center;">SAVEPOINT</td><td style="text-align:center;">ƒê√°nh d·∫•u m·ªôt ƒëi·ªÉm ƒë·ªÉ rollback m·ªôt ph·∫ßn transaction</td></tr></tbody></table><h3 id="üîπ-commit-‚Äì-luu-thay-ƒëoi-vinh-vien" tabindex="-1"><a class="header-anchor" href="#üîπ-commit-‚Äì-luu-thay-ƒëoi-vinh-vien"><span>üîπ COMMIT ‚Äì L∆∞u thay ƒë·ªïi vƒ©nh vi·ªÖn</span></a></h3><p>Sau khi COMMIT, d·ªØ li·ªáu kh√¥ng th·ªÉ rollback l·∫°i.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-rollback-‚Äì-huy-bo-transaction" tabindex="-1"><a class="header-anchor" href="#üîπ-rollback-‚Äì-huy-bo-transaction"><span>üîπ ROLLBACK ‚Äì H·ªßy b·ªè Transaction</span></a></h3><p>N·∫øu c√≥ l·ªói, ROLLBACK s·∫Ω ho√†n t√°c m·ªçi thay ƒë·ªïi v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.2</span> <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- C√≥ l·ªói x·∫£y ra</span></span>
<span class="line">    <span class="token keyword">IF</span> some_error <span class="token keyword">THEN</span></span>
<span class="line">        <span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span> <span class="token comment">-- H·ªßy to√†n b·ªô thay ƒë·ªïi</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-savepoint-‚Äì-rollback-tung-phan" tabindex="-1"><a class="header-anchor" href="#üîπ-savepoint-‚Äì-rollback-tung-phan"><span>üîπ SAVEPOINT ‚Äì Rollback t·ª´ng ph·∫ßn</span></a></h3><p>SAVEPOINT gi√∫p rollback m·ªôt ph·∫ßn transaction thay v√¨ rollback to√†n b·ªô.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- C·∫≠p nh·∫≠t l·∫ßn 1</span></span>
<span class="line">    <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">SAVEPOINT</span> sp1<span class="token punctuation">;</span> <span class="token comment">-- L∆∞u l·∫°i tr·∫°ng th√°i</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- C·∫≠p nh·∫≠t l·∫ßn 2</span></span>
<span class="line">    <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.2</span> <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">SAVEPOINT</span> sp2<span class="token punctuation">;</span> <span class="token comment">-- L∆∞u l·∫°i tr·∫°ng th√°i</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- N·∫øu c√≥ l·ªói, rollback v·ªÅ ƒëi·ªÉm sp1 (gi·ªØ l·∫°i c·∫≠p nh·∫≠t l·∫ßn 1)</span></span>
<span class="line">    <span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> sp1<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- Commit ph·∫ßn c√≤n l·∫°i</span></span>
<span class="line">    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sau khi rollback v·ªÅ sp1:</p><p>‚úÖ Thay ƒë·ªïi c·ªßa department_id = 10 v·∫´n gi·ªØ.</p><p>‚ùå Thay ƒë·ªïi c·ªßa department_id = 20 b·ªã h·ªßy.</p><h3 id="üîπ-autocommit-‚Äì-transaction-tu-ƒëong" tabindex="-1"><a class="header-anchor" href="#üîπ-autocommit-‚Äì-transaction-tu-ƒëong"><span>üîπ AUTOCOMMIT ‚Äì Transaction t·ª± ƒë·ªông</span></a></h3><ul><li><p>Ki·ªÉm tra tr·∫°ng th√°i AUTOCOMMIT:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SHOW</span> AUTOCOMMIT<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>T·∫Øt Autocommit ƒë·ªÉ ki·ªÉm so√°t transaction th·ªß c√¥ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SET</span> AUTOCOMMIT <span class="token keyword">OFF</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><a name="2"></a></p><h2 id="üìå-2-dynamic-sql" tabindex="-1"><a class="header-anchor" href="#üìå-2-dynamic-sql"><span>üìå 2. Dynamic SQL</span></a></h2><p>Dynamic SQL (SQL ƒë·ªông) l√† k·ªπ thu·∫≠t cho ph√©p x√¢y d·ª±ng v√† th·ª±c thi c√¢u l·ªánh SQL m·ªôt c√°ch linh ho·∫°t t·∫°i th·ªùi ƒëi·ªÉm ch·∫°y (runtime) thay v√¨ vi·∫øt c·ªë ƒë·ªãnh trong m√£ ngu·ªìn.</p><p>C·∫ßn Dynamic SQL khi:</p><ul><li>C√¢u l·ªánh SQL thay ƒë·ªïi linh ho·∫°t theo d·ªØ li·ªáu ƒë·∫ßu v√†o.</li><li>T√™n b·∫£ng, c·ªôt, ƒëi·ªÅu ki·ªán WHERE kh√¥ng th·ªÉ x√°c ƒë·ªãnh tr∆∞·ªõc.</li><li>C·∫ßn th·ª±c thi DDL (CREATE, DROP, ALTER) trong PL/SQL.</li><li>C·∫ßn g·ªçi stored procedure v·ªõi tham s·ªë ƒë·ªông.</li></ul><h3 id="üîπ-cach-thuc-hien-dynamic-sql" tabindex="-1"><a class="header-anchor" href="#üîπ-cach-thuc-hien-dynamic-sql"><span>üîπ C√°ch th·ª±c hi·ªán Dynamic SQL</span></a></h3><p>PL/SQL cung c·∫•p hai c√°ch ch√≠nh ƒë·ªÉ th·ª±c thi Dynamic SQL:</p><table><thead><tr><th style="text-align:center;">C√°ch</th><th style="text-align:center;">Khi n√†o d√πng?</th></tr></thead><tbody><tr><td style="text-align:center;">EXECUTE IMMEDIATE</td><td style="text-align:center;">Khi c√¢u l·ªánh ch·ªâ ch·∫°y m·ªôt l·∫ßn</td></tr><tr><td style="text-align:center;">OPEN FOR ... USING</td><td style="text-align:center;">Khi c·∫ßn fetch nhi·ªÅu d√≤ng d·ªØ li·ªáu (d√πng v·ªõi CURSOR)</td></tr></tbody></table><h3 id="üîπ-execute-immediate-‚Äì-cach-ƒëon-gian-nhat" tabindex="-1"><a class="header-anchor" href="#üîπ-execute-immediate-‚Äì-cach-ƒëon-gian-nhat"><span>üîπ EXECUTE IMMEDIATE ‚Äì C√°ch ƒë∆°n gi·∫£n nh·∫•t</span></a></h3><p>D√πng ƒë·ªÉ th·ª±c thi c√°c c√¢u l·ªánh SELECT, INSERT, UPDATE, DELETE, DDL.</p><p>üîç V√≠ d·ª• SELECT ƒë·ªông:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_table_name VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">&#39;employees&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    v_count NUMBER<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">EXECUTE</span> IMMEDIATE <span class="token string">&#39;SELECT COUNT(*) FROM &#39;</span> <span class="token operator">||</span> v_table_name <span class="token keyword">INTO</span> v_count<span class="token punctuation">;</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Total rows: &#39;</span> <span class="token operator">||</span> v_count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>üîç V√≠ d·ª• d√πng USING ƒë·ªÉ truy·ªÅn tham s·ªë:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_sql VARCHAR2<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_salary NUMBER :<span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_sql :<span class="token operator">=</span> <span class="token string">&#39;UPDATE employees SET salary = salary + 100 WHERE salary &gt; :min_salary&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">EXECUTE</span> IMMEDIATE v_sql <span class="token keyword">USING</span> v_salary<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-open-for-using-‚Äì-dynamic-cursor" tabindex="-1"><a class="header-anchor" href="#üîπ-open-for-using-‚Äì-dynamic-cursor"><span>üîπ OPEN FOR ... USING ‚Äì Dynamic Cursor</span></a></h3><p>üîç V√≠ d·ª• Fetch d·ªØ li·ªáu ƒë·ªông v·ªõi CURSOR:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_cursor SYS_REFCURSOR<span class="token punctuation">;</span></span>
<span class="line">    v_table_name VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">&#39;employees&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp_name employees<span class="token punctuation">.</span>last_name<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- M·ªü cursor v·ªõi b·∫£ng ƒë·ªông</span></span>
<span class="line">    <span class="token keyword">OPEN</span> v_cursor <span class="token keyword">FOR</span> <span class="token string">&#39;SELECT last_name FROM &#39;</span> <span class="token operator">||</span> v_table_name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">FETCH</span> v_cursor <span class="token keyword">INTO</span> v_emp_name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> v_cursor<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Employee: &#39;</span> <span class="token operator">||</span> v_emp_name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">CLOSE</span> v_cursor<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="3"></a></p><h2 id="üìå-3-collection-va-record-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#üìå-3-collection-va-record-trong-pl-sql"><span>üìå 3. Collection v√† Record trong PL/SQL</span></a></h2><p>Collection trong PL/SQL l√† m·ªôt c·∫•u tr√∫c d·ªØ li·ªáu ch·ª©a nhi·ªÅu ph·∫ßn t·ª≠ c√πng ki·ªÉu d·ªØ li·ªáu, t∆∞∆°ng t·ª± nh∆∞ m·∫£ng trong c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh kh√°c.</p><p>PL/SQL h·ªó tr·ª£ 3 lo·∫°i Collection ch√≠nh:</p><table><thead><tr><th style="text-align:center;">Lo·∫°i Collection</th><th style="text-align:center;">Khi n√†o d√πng?</th><th style="text-align:center;">ƒê·∫∑c ƒëi·ªÉm</th></tr></thead><tbody><tr><td style="text-align:center;">VARRAY</td><td style="text-align:center;">Khi s·ªë ph·∫ßn t·ª≠ c·ªë ƒë·ªãnh</td><td style="text-align:center;">Ch·ªâ ƒë·ªãnh s·ªë l∆∞·ª£ng t·ªëi ƒëa; L∆∞u trong m·ªôt c·ªôt c·ªßa b·∫£ng</td></tr><tr><td style="text-align:center;">Nested Table</td><td style="text-align:center;">Khi c·∫ßn danh s√°ch ƒë·ªông</td><td style="text-align:center;">Kh√¥ng gi·ªõi h·∫°n ph·∫ßn t·ª≠; C√≥ th·ªÉ l∆∞u v√†o b·∫£ng d∆∞·ªõi d·∫°ng c·ªôt</td></tr><tr><td style="text-align:center;">Associative Array (Index-by Table)</td><td style="text-align:center;">Khi c·∫ßn truy xu·∫•t theo key</td><td style="text-align:center;">Key c√≥ th·ªÉ l√† s·ªë ho·∫∑c chu·ªói; Kh√¥ng l∆∞u trong DB</td></tr></tbody></table><h3 id="üîπ-varray-‚Äì-mang-co-ƒëinh-so-phan-tu" tabindex="-1"><a class="header-anchor" href="#üîπ-varray-‚Äì-mang-co-ƒëinh-so-phan-tu"><span>üîπ VARRAY ‚Äì M·∫£ng c·ªë ƒë·ªãnh s·ªë ph·∫ßn t·ª≠</span></a></h3><p>Khai b√°o v√† s·ª≠ d·ª•ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_varray <span class="token operator">IS</span> VARRAY<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">OF</span> VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_departments t_varray :<span class="token operator">=</span> t_varray<span class="token punctuation">(</span><span class="token string">&#39;HR&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;IT&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Finance&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;First department: &#39;</span> <span class="token operator">||</span> v_departments<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-nested-table-‚Äì-mang-ƒëong" tabindex="-1"><a class="header-anchor" href="#üîπ-nested-table-‚Äì-mang-ƒëong"><span>üîπ Nested Table ‚Äì M·∫£ng ƒë·ªông</span></a></h3><p>Khai b√°o v√† s·ª≠ d·ª•ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_table <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_employees t_table :<span class="token operator">=</span> t_table<span class="token punctuation">(</span><span class="token string">&#39;John&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Alice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Bob&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_employees<span class="token punctuation">.</span>EXTEND<span class="token punctuation">;</span> <span class="token comment">-- M·ªü r·ªông s·ªë ph·∫ßn t·ª≠</span></span>
<span class="line">    v_employees<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">&#39;David&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token punctuation">.</span>v_employees<span class="token punctuation">.</span>COUNT <span class="token keyword">LOOP</span></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Employee: &#39;</span> <span class="token operator">||</span> v_employees<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-associative-array-‚Äì-truy-xuat-theo-key" tabindex="-1"><a class="header-anchor" href="#üîπ-associative-array-‚Äì-truy-xuat-theo-key"><span>üîπ Associative Array ‚Äì Truy xu·∫•t theo Key</span></a></h3><p>Khai b√°o v√† s·ª≠ d·ª•ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_assoc <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">INDEX</span> <span class="token keyword">BY</span> VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_employees t_assoc<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_employees<span class="token punctuation">(</span><span class="token string">&#39;E001&#39;</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    v_employees<span class="token punctuation">(</span><span class="token string">&#39;E002&#39;</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">&#39;Alice&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Employee E001: &#39;</span> <span class="token operator">||</span> v_employees<span class="token punctuation">(</span><span class="token string">&#39;E001&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-record" tabindex="-1"><a class="header-anchor" href="#üîπ-record"><span>üîπ RECORD</span></a></h3><p>Record gi√∫p nh√≥m nhi·ªÅu tr∆∞·ªùng d·ªØ li·ªáu v√†o m·ªôt bi·∫øn duy nh·∫•t.</p><p>Khai b√°o v√† s·ª≠ d·ª•ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_employee <span class="token operator">IS</span> RECORD <span class="token punctuation">(</span></span>
<span class="line">        emp_id NUMBER<span class="token punctuation">,</span></span>
<span class="line">        emp_name VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        salary NUMBER</span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp t_employee<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_emp<span class="token punctuation">.</span>emp_id :<span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp<span class="token punctuation">.</span>emp_name :<span class="token operator">=</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp<span class="token punctuation">.</span>salary :<span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Employee: &#39;</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>emp_name <span class="token operator">||</span> <span class="token string">&#39; - Salary: &#39;</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-record-voi-cursor-‚Äì-fetch-nhieu-dong" tabindex="-1"><a class="header-anchor" href="#üîπ-record-voi-cursor-‚Äì-fetch-nhieu-dong"><span>üîπ RECORD v·ªõi CURSOR ‚Äì Fetch nhi·ªÅu d√≤ng</span></a></h3><p>C√≥ th·ªÉ d√πng RECORD ƒë·ªÉ ch·ª©a t·ª´ng d√≤ng d·ªØ li·ªáu:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_employee <span class="token operator">IS</span> RECORD <span class="token punctuation">(</span></span>
<span class="line">        emp_id employees<span class="token punctuation">.</span>employee_id<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">,</span></span>
<span class="line">        emp_name employees<span class="token punctuation">.</span>last_name<span class="token operator">%</span><span class="token keyword">TYPE</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp t_employee<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CURSOR</span> c_emp <span class="token operator">IS</span> <span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">OPEN</span> c_emp<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">FETCH</span> c_emp <span class="token keyword">INTO</span> v_emp<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> c_emp<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span>v_emp<span class="token punctuation">.</span>emp_id <span class="token operator">||</span> <span class="token string">&#39; - &#39;</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>emp_name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CLOSE</span> c_emp<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="4"></a></p><h2 id="üìå-4-bulk-processing-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#üìå-4-bulk-processing-trong-pl-sql"><span>üìå 4. Bulk Processing trong PL/SQL</span></a></h2><p>Bulk Processing gi√∫p x·ª≠ l√Ω nhi·ªÅu d√≤ng d·ªØ li·ªáu c√πng l√∫c, gi·∫£m s·ªë l·∫ßn t∆∞∆°ng t√°c v·ªõi SQL Engine, gi√∫p tƒÉng hi·ªáu su·∫•t ƒë√°ng k·ªÉ so v·ªõi c√°ch x·ª≠ l√Ω t·ª´ng d√≤ng ri√™ng l·∫ª.</p><p>PL/SQL cung c·∫•p 2 c∆° ch·∫ø ch√≠nh:</p><ul><li>BULK COLLECT ‚Üí L·∫•y nhi·ªÅu d√≤ng d·ªØ li·ªáu v√†o Collection c√πng l√∫c</li><li>FORALL ‚Üí Ch√®n, c·∫≠p nh·∫≠t, x√≥a nhi·ªÅu d√≤ng d·ªØ li·ªáu c√πng l√∫c</li></ul><h3 id="üîπ-bulk-collect-‚Äì-lay-nhieu-dong-du-lieu" tabindex="-1"><a class="header-anchor" href="#üîπ-bulk-collect-‚Äì-lay-nhieu-dong-du-lieu"><span>üîπ BULK COLLECT ‚Äì L·∫•y nhi·ªÅu d√≤ng d·ªØ li·ªáu</span></a></h3><p>üí° Thay v√¨ d√πng LOOP ƒë·ªÉ FETCH t·ª´ng d√≤ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span></span>
<span class="line">    v_emp_list t_emp_list<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CURSOR</span> c_emp <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">OPEN</span> c_emp<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">FETCH</span> c_emp <span class="token keyword">INTO</span> v_emp_list<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> c_emp<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CLOSE</span> c_emp<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>üí° C√≥ th·ªÉ d√πng BULK COLLECT ƒë·ªÉ l·∫•y to√†n b·ªô d·ªØ li·ªáu m·ªôt l·∫ßn:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span></span>
<span class="line">    v_emp_list t_emp_list<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> v_emp_list <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>‚úÖ L·ª£i √≠ch c·ªßa BULK COLLECT:</p><ul><li>Gi·∫£m s·ªë l·∫ßn g·ªçi FETCH</li><li>Nhanh h∆°n g·∫•p nhi·ªÅu l·∫ßn khi x·ª≠ l√Ω s·ªë l∆∞·ª£ng l·ªõn d·ªØ li·ªáu</li><li>C√≥ th·ªÉ k·∫øt h·ª£p v·ªõi LIMIT ƒë·ªÉ tr√°nh qu√° t·∫£i b·ªô nh·ªõ (xem v√≠ d·ª• b√™n d∆∞·ªõi)</li></ul><h3 id="üîπ-forall-‚Äì-chen-cap-nhat-xoa-hang-loat" tabindex="-1"><a class="header-anchor" href="#üîπ-forall-‚Äì-chen-cap-nhat-xoa-hang-loat"><span>üîπ FORALL ‚Äì Ch√®n, c·∫≠p nh·∫≠t, x√≥a h√†ng lo·∫°t</span></a></h3><p>üí° Thay v√¨ d√πng v√≤ng FOR ƒë·ªÉ INSERT/UPDATE/DELETE t·ª´ng d√≤ng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_id_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token punctuation">.</span>employee_id<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp_id_list t_emp_id_list :<span class="token operator">=</span> t_emp_id_list<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token punctuation">.</span>v_emp_id_list<span class="token punctuation">.</span>COUNT <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> v_emp_id_list<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>üí° C√≥ th·ªÉ d√πng FORALL ƒë·ªÉ th·ª±c hi·ªán nhi·ªÅu d√≤ng m·ªôt l·∫ßn:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_id_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token punctuation">.</span>employee_id<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp_id_list t_emp_id_list :<span class="token operator">=</span> t_emp_id_list<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    FORALL i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token punctuation">.</span>v_emp_id_list<span class="token punctuation">.</span>COUNT</span>
<span class="line">        <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> v_emp_id_list<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-ket-hop-bulk-collect-forall" tabindex="-1"><a class="header-anchor" href="#üîπ-ket-hop-bulk-collect-forall"><span>üîπ K·∫øt h·ª£p BULK COLLECT + FORALL</span></a></h3><p>üí° T√≠ch h·ª£p BULK COLLECT ƒë·ªÉ l·∫•y d·ªØ li·ªáu v√† FORALL ƒë·ªÉ x·ª≠ l√Ω h√†ng lo·∫°t:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_id_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token punctuation">.</span>employee_id<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_emp_id_list t_emp_id_list<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- L·∫•y danh s√°ch employee_id c·ªßa ph√≤ng ban 10</span></span>
<span class="line">    <span class="token keyword">SELECT</span> employee_id <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> v_emp_id_list <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- C·∫≠p nh·∫≠t l∆∞∆°ng h√†ng lo·∫°t</span></span>
<span class="line">    FORALL i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token punctuation">.</span>v_emp_id_list<span class="token punctuation">.</span>COUNT</span>
<span class="line">        <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> v_emp_id_list<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="üîπ-dung-bulk-collect-voi-limit" tabindex="-1"><a class="header-anchor" href="#üîπ-dung-bulk-collect-voi-limit"><span>üîπ D√πng BULK COLLECT v·ªõi LIMIT</span></a></h3><p>N·∫øu d·ªØ li·ªáu qu√° l·ªõn, c√≥ th·ªÉ d√πng LIMIT ƒë·ªÉ chia nh·ªè c√°c l·∫ßn l·∫•y d·ªØ li·ªáu.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">TYPE</span> t_emp_list <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> employees<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span></span>
<span class="line">    v_emp_list t_emp_list<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CURSOR</span> c_emp <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">OPEN</span> c_emp<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">FETCH</span> c_emp <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> v_emp_list <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">-- L·∫•y 100 d√≤ng m·ªói l·∫ßn</span></span>
<span class="line">        <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> v_emp_list<span class="token punctuation">.</span>COUNT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        FORALL i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token punctuation">.</span>v_emp_list<span class="token punctuation">.</span>COUNT</span>
<span class="line">            <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> v_emp_list<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>employee_id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">CLOSE</span> c_emp<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-DOb7ZgK3.js" defer></script>
  </body>
</html>
