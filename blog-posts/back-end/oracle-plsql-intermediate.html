<!doctype html>
<html lang="vi-VN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/vuepress-blog/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,400,500,600,700&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><title>Store Procedure, Function, Cursor và Triggers trong PL/SQL | Kiến Thức Từ Trải Nghiệm</title><meta name="description" content="Một blog được tạo bằng VuePress">
    <link rel="preload" href="/vuepress-blog/assets/style-B1g75gDY.css" as="style"><link rel="stylesheet" href="/vuepress-blog/assets/style-B1g75gDY.css">
    <link rel="modulepreload" href="/vuepress-blog/assets/app-B_aW_us5.js"><link rel="modulepreload" href="/vuepress-blog/assets/oracle-plsql-intermediate.html-Bfvq2Res.js">
    <link rel="prefetch" href="/vuepress-blog/assets/index.html-qpMOeNNK.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-1mT6tdvz.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-DbcGQFko.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-7tWpAsXA.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-D5mVk4ZI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/fastapi-base-project.html-DyNHypAU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/mov-to-mp4-converter.html-B0o6RJ-z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-accuracy-perfomance.html-YJFj0CUa.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-cache-tesseract.html-CSfTOZdU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-gioi-thieu-tesseract.html-DQRHHMbm.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-practical.html-CDhzB2D2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-template-matching.html-CtxjhAHK.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tong-quan.html-BdPirIF7.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-training-tesseract.html-Ca3rc2qh.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-advanced.html-KH_wHkrU.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-beginner.html-CXNKILoT.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/oracle-plsql-expert.html-Dqe3PyH4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-advanced.html-Dn2B1B7A.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/redis-basic.html-C6GzlyXJ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-cloud-computing.html-DoMir4NJ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-database.html-DPlOIUoD.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-ec2.html-DltAzvU3.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-gioi-thieu-aws.html-DXeg5ldO.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-iam.html-8RFLpJ5f.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-monitoring.html-BwFgSJuM.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-networking.html-DtaG-mRZ.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-storage.html-C6XNZB9m.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-beginner.html-CLhZ-4FF.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-intermediate.html-BfBxP89z.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/linux-shell-script.html-BROpABs8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/aws-training-saa-series.html-my5FuGT4.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/ocr-tesseract-series.html-CK7TW4Mn.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/plsql-training-series.html-BOqdo233.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-yE-a7NJw.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-X9XitxP6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/index.html-CJcHN_HI.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/404.html-DJkSWBI6.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/setupDevtools-7MC2TMWH-BzNC6rz-.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/vuepress-blog/"><img class="vp-site-logo" src="/vuepress-blog/images/logo.png" alt="Kiến Thức Từ Trải Nghiệm"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Kiến Thức Từ Trải Nghiệm</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Chủ"><!---->Trang Chủ<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="Dự Án"><!---->Dự Án<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="Về Tôi"><!---->Về Tôi<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ngôn Ngữ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ngôn Ngữ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/back-end/oracle-plsql-intermediate.html" aria-label="Tiếng Việt"><!---->Tiếng Việt<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/" aria-label="Trang Chủ"><!---->Trang Chủ<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/project/" aria-label="Dự Án"><!---->Dự Án<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/blog/" aria-label="Blog"><!---->Blog<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/vuepress-blog/about/" aria-label="Về Tôi"><!---->Về Tôi<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Ngôn Ngữ</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Ngôn Ngữ</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-blog/blog-posts/back-end/oracle-plsql-intermediate.html" aria-label="Tiếng Việt"><!---->Tiếng Việt<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vuepress-blog/en/" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="store-procedure-function-cursor-va-triggers" tabindex="-1"><a class="header-anchor" href="#store-procedure-function-cursor-va-triggers"><span>Store Procedure, Function, Cursor và Triggers</span></a></h1><p><a href="#1">1. Store Procedure</a></p><p><a href="#2">2. Function</a></p><p><a href="#3">3. Cursor</a></p><p><a href="#4">4. Triggers</a></p><p><a href="#5">5. Package</a></p><p><a name="1"></a></p><h2 id="📌-1-store-procedure-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#📌-1-store-procedure-trong-pl-sql"><span>📌 1. Store Procedure trong PL/SQL</span></a></h2><p>Một PROCEDURE trong PL/SQL là một khối mã có thể tái sử dụng, thực hiện một nhiệm vụ cụ thể mà không trả về giá trị trực tiếp (khác với FUNCTION).</p><h3 id="🔹-tao-mot-procedure" tabindex="-1"><a class="header-anchor" href="#🔹-tao-mot-procedure"><span>🔹 Tạo một PROCEDURE</span></a></h3><p>Cú pháp chung:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token keyword">PROCEDURE</span> procedure_name</span>
<span class="line"><span class="token punctuation">(</span></span>
<span class="line">    param1 <span class="token punctuation">[</span><span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token operator">IN</span> <span class="token keyword">OUT</span><span class="token punctuation">]</span> datatype<span class="token punctuation">,</span></span>
<span class="line">    param2 <span class="token punctuation">[</span><span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token operator">IN</span> <span class="token keyword">OUT</span><span class="token punctuation">]</span> datatype<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line">    <span class="token comment">-- Khai báo biến (nếu cần)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- Khối lệnh thực thi</span></span>
<span class="line">EXCEPTION</span>
<span class="line">    <span class="token comment">-- Xử lý lỗi (nếu cần)</span></span>
<span class="line"><span class="token keyword">END</span> procedure_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích:</p><ul><li>CREATE OR REPLACE PROCEDURE → Tạo hoặc thay thế một procedure.</li><li>procedure_name → Tên procedure.</li><li>param1, param2, ... → Danh sách tham số (có thể không có). <ul><li>IN → Tham số đầu vào (mặc định).</li><li>OUT → Tham số đầu ra (trả về giá trị sau khi thực thi).</li><li>IN OUT → Tham số vừa nhập vào, vừa xuất ra.</li></ul></li><li>IS / AS → Bắt đầu phần thân của procedure.</li><li>BEGIN ... END; → Chứa logic thực thi.</li><li>EXCEPTION → Xử lý lỗi nếu có.</li></ul><h3 id="🔹-vi-du-co-ban" tabindex="-1"><a class="header-anchor" href="#🔹-vi-du-co-ban"><span>🔹 Ví dụ cơ bản</span></a></h3><h4 id="_1️⃣-procedure-khong-co-tham-so" tabindex="-1"><a class="header-anchor" href="#_1️⃣-procedure-khong-co-tham-so"><span>1️⃣ Procedure không có tham số:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> say_hello</span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Hello, PL/SQL!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> say_hello<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>📢 Cách gọi procedure:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    say_hello<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2️⃣-procedure-co-tham-so-đau-vao-in" tabindex="-1"><a class="header-anchor" href="#_2️⃣-procedure-co-tham-so-đau-vao-in"><span>2️⃣ Procedure có tham số đầu vào (IN):</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> greet_user<span class="token punctuation">(</span>p_name <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Xin chào, &#39;</span> <span class="token operator">||</span> p_name <span class="token operator">||</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> greet_user<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>📢 Cách gọi procedure:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    greet_user<span class="token punctuation">(</span><span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3️⃣-procedure-co-tham-so-đau-ra-out" tabindex="-1"><a class="header-anchor" href="#_3️⃣-procedure-co-tham-so-đau-ra-out"><span>3️⃣ Procedure có tham số đầu ra (OUT):</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> get_salary<span class="token punctuation">(</span></span>
<span class="line">    p_emp_id <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span></span>
<span class="line">    p_salary <span class="token keyword">OUT</span> NUMBER</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> p_salary <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> p_emp_id<span class="token punctuation">;</span></span>
<span class="line">EXCEPTION</span>
<span class="line">    <span class="token keyword">WHEN</span> NO_DATA_FOUND <span class="token keyword">THEN</span></span>
<span class="line">        p_salary :<span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> get_salary<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4️⃣-procedure-co-tham-so-vua-nhap-vua-xuat-in-out" tabindex="-1"><a class="header-anchor" href="#_4️⃣-procedure-co-tham-so-vua-nhap-vua-xuat-in-out"><span>4️⃣ Procedure có tham số vừa nhập vừa xuất (IN OUT):</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> update_salary<span class="token punctuation">(</span></span>
<span class="line">    p_emp_id <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span></span>
<span class="line">    p_new_salary <span class="token operator">IN</span> <span class="token keyword">OUT</span> NUMBER</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> p_new_salary <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> p_emp_id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line">    p_new_salary :<span class="token operator">=</span> p_new_salary <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">-- Thay đổi giá trị tham số</span></span>
<span class="line"><span class="token keyword">END</span> update_salary<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="🔹-xoa-mot-procedure" tabindex="-1"><a class="header-anchor" href="#🔹-xoa-mot-procedure"><span>🔹 Xóa một PROCEDURE</span></a></h3><p>Để xóa một procedure, dùng lệnh:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> procedure_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a name="2"></a></p><h2 id="📌-2-function-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#📌-2-function-trong-pl-sql"><span>📌 2. Function trong PL/SQL</span></a></h2><p>Một FUNCTION trong PL/SQL là một khối mã có thể tái sử dụng, thực hiện một nhiệm vụ cụ thể và bắt buộc phải trả về một giá trị.</p><h3 id="🔹-tao-mot-function" tabindex="-1"><a class="header-anchor" href="#🔹-tao-mot-function"><span>🔹 Tạo một FUNCTION</span></a></h3><p>Cú pháp chung:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token keyword">FUNCTION</span> function_name</span>
<span class="line"><span class="token punctuation">(</span></span>
<span class="line">    param1 <span class="token punctuation">[</span><span class="token operator">IN</span><span class="token punctuation">]</span> datatype<span class="token punctuation">,</span></span>
<span class="line">    param2 <span class="token punctuation">[</span><span class="token operator">IN</span><span class="token punctuation">]</span> datatype<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURN</span> return_datatype</span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line">    <span class="token comment">-- Khai báo biến (nếu cần)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- Thực hiện xử lý</span></span>
<span class="line">    <span class="token keyword">RETURN</span> giá_trị<span class="token punctuation">;</span></span>
<span class="line">EXCEPTION</span>
<span class="line">    <span class="token comment">-- Xử lý lỗi (nếu cần)</span></span>
<span class="line"><span class="token keyword">END</span> function_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích:</p><ul><li>CREATE OR REPLACE FUNCTION → Tạo hoặc thay thế function</li><li>function_name → Tên function</li><li>param1, param2, ... → Danh sách tham số (chỉ hỗ trợ IN, không có OUT hoặc IN OUT)</li><li>RETURN return_datatype → Xác định kiểu dữ liệu trả về.</li><li>RETURN giá_trị; → Function bắt buộc phải có câu lệnh RETURN</li></ul><h3 id="🔹-vi-du-co-ban-1" tabindex="-1"><a class="header-anchor" href="#🔹-vi-du-co-ban-1"><span>🔹 Ví dụ cơ bản</span></a></h3><h4 id="_1️⃣-function-tinh-tong-hai-so" tabindex="-1"><a class="header-anchor" href="#_1️⃣-function-tinh-tong-hai-so"><span>1️⃣ Function tính tổng hai số:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> sum_two_numbers<span class="token punctuation">(</span></span>
<span class="line">    p_num1 <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span></span>
<span class="line">    p_num2 <span class="token operator">IN</span> NUMBER</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURN</span> NUMBER</span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">RETURN</span> p_num1 <span class="token operator">+</span> p_num2<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> sum_two_numbers<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích: Function trên nhận hai số p_num1 và p_num2, sau đó trả về tổng của chúng.</p><p>📢 Cách gọi function:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_result NUMBER<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_result :<span class="token operator">=</span> sum_two_numbers<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Tổng hai số: &#39;</span> <span class="token operator">||</span> v_result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2️⃣-function-lay-luong-nhan-vien" tabindex="-1"><a class="header-anchor" href="#_2️⃣-function-lay-luong-nhan-vien"><span>2️⃣ Function lấy lương nhân viên:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> get_salary<span class="token punctuation">(</span>p_emp_id <span class="token operator">IN</span> NUMBER<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURN</span> NUMBER</span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line">    v_salary NUMBER<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> v_salary <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> p_emp_id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">RETURN</span> v_salary<span class="token punctuation">;</span></span>
<span class="line">EXCEPTION</span>
<span class="line">    <span class="token keyword">WHEN</span> NO_DATA_FOUND <span class="token keyword">THEN</span></span>
<span class="line">        <span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> get_salary<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích:</p><ul><li>Function truy vấn lương của nhân viên theo emp_id và trả về kết quả.</li><li>Nếu không tìm thấy nhân viên, function trả về NULL.</li></ul><p>📢 Cách gọi function trong SQL:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> get_salary<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> dual<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>📢 Hoặc trong PL/SQL block</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_salary NUMBER<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    v_salary :<span class="token operator">=</span> get_salary<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Lương nhân viên: &#39;</span> <span class="token operator">||</span> v_salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3️⃣-function-co-xu-ly-ngoai-le" tabindex="-1"><a class="header-anchor" href="#_3️⃣-function-co-xu-ly-ngoai-le"><span>3️⃣ Function có xử lý ngoại lệ:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> get_department_name<span class="token punctuation">(</span>p_dept_id <span class="token operator">IN</span> NUMBER<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURN</span> VARCHAR2</span>
<span class="line"><span class="token operator">IS</span></span>
<span class="line">    v_dept_name VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SELECT</span> name <span class="token keyword">INTO</span> v_dept_name <span class="token keyword">FROM</span> departments <span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> p_dept_id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">RETURN</span> v_dept_name<span class="token punctuation">;</span></span>
<span class="line">EXCEPTION</span>
<span class="line">    <span class="token keyword">WHEN</span> NO_DATA_FOUND <span class="token keyword">THEN</span></span>
<span class="line">        <span class="token keyword">RETURN</span> <span class="token string">&#39;Không tìm thấy phòng ban&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> get_department_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="🔹-xoa-mot-function" tabindex="-1"><a class="header-anchor" href="#🔹-xoa-mot-function"><span>🔹 Xóa một FUNCTION</span></a></h3><p>Để xóa một function, dùng lệnh:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> function_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Ví dụ:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> sum_two_numbers<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a name="3"></a></p><h2 id="📌-3-cursor-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#📌-3-cursor-trong-pl-sql"><span>📌 3. Cursor trong PL/SQL</span></a></h2><ul><li>Khi thực hiện một truy vấn SELECT, dữ liệu trả về có thể là nhiều dòng.</li><li>Cursor giúp lặp qua từng dòng dữ liệu đó một cách có kiểm soát.</li><li>Có hai loại Cursor trong PL/SQL: <ul><li>Implicit Cursor (Con trỏ ẩn): Oracle tự động tạo ra.</li><li>Explicit Cursor (Con trỏ tường minh): Do lập trình viên định nghĩa</li></ul></li></ul><h3 id="🔹-implicit-cursor-con-tro-an" tabindex="-1"><a class="header-anchor" href="#🔹-implicit-cursor-con-tro-an"><span>🔹 Implicit Cursor (Con trỏ ẩn)</span></a></h3><p>Oracle tự động sử dụng Implicit Cursor khi thực hiện các lệnh INSERT, UPDATE, DELETE hoặc SELECT INTO.</p><p>🔍 Ví dụ: Sử dụng Implicit Cursor với SELECT INTO</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    v_emp_name employees<span class="token punctuation">.</span>last_name<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_salary employees<span class="token punctuation">.</span>salary<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span> salary</span>
<span class="line">    <span class="token keyword">INTO</span> v_emp_name<span class="token punctuation">,</span> v_salary</span>
<span class="line">    <span class="token keyword">FROM</span> employees</span>
<span class="line">    <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Employee: &#39;</span> <span class="token operator">||</span> v_emp_name <span class="token operator">||</span> <span class="token string">&#39;, Salary: &#39;</span> <span class="token operator">||</span> v_salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>⚠️ <em>Lưu ý:</em> SELECT INTO chỉ hoạt động khi kết quả trả về đúng một dòng, nếu có nhiều hơn sẽ bị lỗi.</p><h3 id="🔹-explicit-cursor-con-tro-tuong-minh" tabindex="-1"><a class="header-anchor" href="#🔹-explicit-cursor-con-tro-tuong-minh"><span>🔹 Explicit Cursor (Con trỏ tường minh)</span></a></h3><p>Explicit Cursor giúp lấy nhiều dòng dữ liệu và duyệt qua từng dòng một cách linh hoạt.</p><p>Cách sử dụng:</p><h4 id="_1️⃣-khai-bao-cursor" tabindex="-1"><a class="header-anchor" href="#_1️⃣-khai-bao-cursor"><span>1️⃣ Khai báo Cursor:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CURSOR</span> cursor_name <span class="token operator">IS</span> <span class="token operator">&lt;</span><span class="token keyword">SELECT</span> query<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2️⃣-mo-cursor" tabindex="-1"><a class="header-anchor" href="#_2️⃣-mo-cursor"><span>2️⃣ Mở Cursor</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">OPEN</span> cursor_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3️⃣-lay-du-lieu-tu-cursor" tabindex="-1"><a class="header-anchor" href="#_3️⃣-lay-du-lieu-tu-cursor"><span>3️⃣ Lấy dữ liệu từ Cursor</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">FETCH</span> cursor_name <span class="token keyword">INTO</span> variable1<span class="token punctuation">,</span> variable2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_4️⃣-đong-cursor" tabindex="-1"><a class="header-anchor" href="#_4️⃣-đong-cursor"><span>4️⃣ Đóng Cursor</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CLOSE</span> cursor_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="🔹-vi-du-co-ban-explicit-cursor" tabindex="-1"><a class="header-anchor" href="#🔹-vi-du-co-ban-explicit-cursor"><span>🔹 Ví dụ cơ bản Explicit Cursor</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    <span class="token keyword">CURSOR</span> emp_cursor <span class="token operator">IS</span></span>
<span class="line">        <span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span> last_name<span class="token punctuation">,</span> salary <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    v_id employees<span class="token punctuation">.</span>employee_id<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_name employees<span class="token punctuation">.</span>last_name<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line">    v_salary employees<span class="token punctuation">.</span>salary<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">OPEN</span> emp_cursor<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">LOOP</span></span>
<span class="line">        <span class="token keyword">FETCH</span> emp_cursor <span class="token keyword">INTO</span> v_id<span class="token punctuation">,</span> v_name<span class="token punctuation">,</span> v_salary<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> emp_cursor<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;ID: &#39;</span> <span class="token operator">||</span> v_id <span class="token operator">||</span> <span class="token string">&#39;, Name: &#39;</span> <span class="token operator">||</span> v_name <span class="token operator">||</span> <span class="token string">&#39;, Salary: &#39;</span> <span class="token operator">||</span> v_salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">CLOSE</span> emp_cursor<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích:</p><ul><li>FETCH emp_cursor INTO v_id, v_name, v_salary; lấy từng dòng dữ liệu.</li><li>EXIT WHEN emp_cursor%NOTFOUND; dừng vòng lặp khi không còn dữ liệu.</li><li>CLOSE emp_cursor; giải phóng con trỏ sau khi sử dụng.</li></ul><h3 id="🔹-thuoc-tinh-cua-cursor" tabindex="-1"><a class="header-anchor" href="#🔹-thuoc-tinh-cua-cursor"><span>🔹 Thuộc tính của Cursor</span></a></h3><p>PL/SQL cung cấp 4 thuộc tính giúp kiểm soát quá trình làm việc với Cursor:</p><table><thead><tr><th style="text-align:center;">Thuộc tính</th><th style="text-align:center;">Ý nghĩa</th></tr></thead><tbody><tr><td style="text-align:center;">%FOUND</td><td style="text-align:center;">TRUE nếu FETCH thành công, FALSE nếu không có dữ liệu</td></tr><tr><td style="text-align:center;">%NOTFOUND</td><td style="text-align:center;">TRUE nếu không có dữ liệu, FALSE nếu có dữ liệu</td></tr><tr><td style="text-align:center;">%ISOPEN</td><td style="text-align:center;">TRUE nếu Cursor đang mở, FALSE nếu đã đóng</td></tr><tr><td style="text-align:center;">%ROWCOUNT</td><td style="text-align:center;">Số dòng đã lấy từ Cursor</td></tr></tbody></table><p>🔍 Ví dụ: Kiểm tra số dòng đã fetch</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">FETCH</span> emp_cursor <span class="token keyword">INTO</span> v_id<span class="token punctuation">,</span> v_name<span class="token punctuation">,</span> v_salary<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">IF</span> emp_cursor<span class="token operator">%</span>FOUND <span class="token keyword">THEN</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Lấy được dòng: &#39;</span> <span class="token operator">||</span> emp_cursor<span class="token operator">%</span><span class="token keyword">ROWCOUNT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="🔹-cursor-for-loop-cach-đon-gian-đe-duyet-cursor" tabindex="-1"><a class="header-anchor" href="#🔹-cursor-for-loop-cach-đon-gian-đe-duyet-cursor"><span>🔹 Cursor FOR LOOP (Cách đơn giản để duyệt Cursor)</span></a></h3><p>Thay vì phải OPEN, FETCH, CLOSE thủ công, PL/SQL cung cấp Cursor FOR LOOP, tự động mở, lấy dữ liệu và đóng Cursor.</p><p>🔍 Ví dụ: Duyệt dữ liệu bằng Cursor FOR LOOP</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">FOR</span> emp_rec <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span> last_name<span class="token punctuation">,</span> salary <span class="token keyword">FROM</span> employees<span class="token punctuation">)</span> <span class="token keyword">LOOP</span></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;ID: &#39;</span> <span class="token operator">||</span> emp_rec<span class="token punctuation">.</span>employee_id <span class="token operator">||</span> <span class="token string">&#39;, Name: &#39;</span> <span class="token operator">||</span> emp_rec<span class="token punctuation">.</span>last_name <span class="token operator">||</span> <span class="token string">&#39;, Salary: &#39;</span> <span class="token operator">||</span> emp_rec<span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="4"></a></p><h2 id="📌-4-trigger-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#📌-4-trigger-trong-pl-sql"><span>📌 4. Trigger trong PL/SQL</span></a></h2><p>Trigger là một khối PL/SQL tự động thực thi khi một sự kiện INSERT, UPDATE, DELETE xảy ra trên một bảng hoặc một view.</p><ul><li>Không cần gọi thủ công, trigger sẽ kích hoạt tự động khi thỏa mãn điều kiện.</li><li>Dùng để kiểm tra dữ liệu, ghi log, tự động cập nhật giá trị, v.v.</li></ul><h3 id="🔹-tao-mot-trigger" tabindex="-1"><a class="header-anchor" href="#🔹-tao-mot-trigger"><span>🔹 Tạo một Trigger</span></a></h3><p>Cú pháp chung:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token punctuation">]</span> <span class="token keyword">TRIGGER</span> trigger_name</span>
<span class="line">{BEFORE <span class="token operator">|</span> <span class="token keyword">AFTER</span> <span class="token operator">|</span> INSTEAD <span class="token keyword">OF</span>}</span>
<span class="line">{<span class="token keyword">INSERT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span>}</span>
<span class="line"><span class="token keyword">ON</span> table_name</span>
<span class="line"><span class="token punctuation">[</span> <span class="token keyword">FOR EACH ROW</span> <span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token comment">-- Khối lệnh thực thi</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🔥 Giải thích:</p><ul><li>BEFORE: Trigger chạy trước khi sự kiện xảy ra.</li><li>AFTER: Trigger chạy sau khi sự kiện hoàn tất.</li><li>INSTEAD OF: Dùng cho VIEW để thay thế hành động gốc.</li><li>FOR EACH ROW: Trigger kích hoạt cho từng dòng bị ảnh hưởng.</li></ul><h3 id="🔹-vi-du-co-ban-2" tabindex="-1"><a class="header-anchor" href="#🔹-vi-du-co-ban-2"><span>🔹 Ví dụ cơ bản</span></a></h3><h4 id="_1️⃣-kiem-tra-du-lieu-truoc-khi-insert" tabindex="-1"><a class="header-anchor" href="#_1️⃣-kiem-tra-du-lieu-truoc-khi-insert"><span>1️⃣ Kiểm tra dữ liệu trước khi INSERT:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">TRIGGER</span> trg_check_salary</span>
<span class="line">BEFORE <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> employees</span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">IF</span> :NEW<span class="token punctuation">.</span>salary <span class="token operator">&lt;</span> <span class="token number">3000000</span> <span class="token keyword">THEN</span></span>
<span class="line">        RAISE_APPLICATION_ERROR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20001</span><span class="token punctuation">,</span> <span class="token string">&#39;Lương phải từ 3 triệu trở lên!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>✅ Kết quả: Nếu cố gắng thêm nhân viên có lương &lt; 3 triệu, hệ thống sẽ báo lỗi.</p><h4 id="_2️⃣-luu-ban-ghi-đa-xoa-vao-bang-backup" tabindex="-1"><a class="header-anchor" href="#_2️⃣-luu-ban-ghi-đa-xoa-vao-bang-backup"><span>2️⃣ Lưu bản ghi đã xóa vào bảng backup:</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">TRIGGER</span> trg_backup_employee</span>
<span class="line"><span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> employees</span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees_backup <span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> salary<span class="token punctuation">,</span> deleted_at<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>:OLD<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span> :OLD<span class="token punctuation">.</span>name<span class="token punctuation">,</span> :OLD<span class="token punctuation">.</span>salary<span class="token punctuation">,</span> SYSDATE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>✅ Kết quả: Khi xóa nhân viên, dữ liệu sẽ được lưu vào bảng backup.</p><h3 id="🔹-xoa-mot-trigger" tabindex="-1"><a class="header-anchor" href="#🔹-xoa-mot-trigger"><span>🔹 Xóa một Trigger</span></a></h3><p>Cú pháp xóa trigger:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> trigger_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>💡 <em>Lưu ý:</em></p><ul><li><p>Khi xóa trigger, nó sẽ biến mất hoàn toàn khỏi database.</p></li><li><p>Nếu muốn chỉ vô hiệu hóa (disable) trigger tạm thời, có thể dùng:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> trigger_name <span class="token keyword">DISABLE</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Và kích hoạt lại khi cần:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> trigger_name <span class="token keyword">ENABLE</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><a name="5"></a></p><h2 id="📌-5-goi-package-trong-pl-sql" tabindex="-1"><a class="header-anchor" href="#📌-5-goi-package-trong-pl-sql"><span>📌 5. Gói (Package) trong PL/SQL</span></a></h2><p>Package trong PL/SQL là một tập hợp các Procedure, Function, Cursor, và biến được nhóm lại thành một module duy nhất.</p><ul><li>Tổ chức code gọn gàng, dễ quản lý.</li><li>Cải thiện hiệu suất, vì các thành phần trong package được nạp vào bộ nhớ khi gọi lần đầu.</li><li>Hỗ trợ tính kế thừa trong PL/SQL.</li></ul><h3 id="🔹-cau-truc-cua-mot-package" tabindex="-1"><a class="header-anchor" href="#🔹-cau-truc-cua-mot-package"><span>🔹 Cấu trúc của một Package</span></a></h3><p>Một Package có 2 phần:</p><ul><li>Package Specification (Giao diện bên ngoài).</li><li>Package Body (Cài đặt chi tiết bên trong).</li></ul><h3 id="🔹-cu-phap-package" tabindex="-1"><a class="header-anchor" href="#🔹-cu-phap-package"><span>🔹 Cú pháp Package</span></a></h3><ul><li><p>Định nghĩa Package Specification (Phần khai báo):</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> PACKAGE package_name <span class="token keyword">AS</span></span>
<span class="line">    <span class="token comment">-- Khai báo hằng số, biến, cursor</span></span>
<span class="line">    var1 NUMBER<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- Khai báo Procedure, Function</span></span>
<span class="line">    <span class="token keyword">PROCEDURE</span> proc_example<span class="token punctuation">(</span>p_id NUMBER<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">FUNCTION</span> func_example<span class="token punctuation">(</span>p_id NUMBER<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> VARCHAR2<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> package_name<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>💡 Package Specification giống như một API — chỉ khai báo cái cần công khai.</p></li><li><p>Định nghĩa Package Body (Phần triển khai):</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> PACKAGE BODY package_name <span class="token keyword">AS</span></span>
<span class="line">    <span class="token comment">-- Cài đặt Procedure</span></span>
<span class="line">    <span class="token keyword">PROCEDURE</span> proc_example<span class="token punctuation">(</span>p_id NUMBER<span class="token punctuation">)</span> <span class="token operator">IS</span></span>
<span class="line">    <span class="token keyword">BEGIN</span></span>
<span class="line">        DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">&#39;Proc called with ID: &#39;</span> <span class="token operator">||</span> p_id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> proc_example<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- Cài đặt Function</span></span>
<span class="line">    <span class="token keyword">FUNCTION</span> func_example<span class="token punctuation">(</span>p_id NUMBER<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> VARCHAR2 <span class="token operator">IS</span></span>
<span class="line">    <span class="token keyword">BEGIN</span></span>
<span class="line">        <span class="token keyword">RETURN</span> <span class="token string">&#39;Hello &#39;</span> <span class="token operator">||</span> p_id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> func_example<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> package_name<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>💡 Package Body chứa code xử lý thực tế của Procedure và Function.</p></li></ul><h3 id="🔹-su-dung-package" tabindex="-1"><a class="header-anchor" href="#🔹-su-dung-package"><span>🔹 Sử dụng Package</span></a></h3><ul><li><p>Gọi Procedure trong Package:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    package_name<span class="token punctuation">.</span>proc_example<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Gọi Function trong Package:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DECLARE</span></span>
<span class="line">    result VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    result :<span class="token operator">=</span> package_name<span class="token punctuation">.</span>func_example<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress-blog/assets/app-B_aW_us5.js" defer></script>
  </body>
</html>
