---
title: Redis Basic
summary: "Redis (REmote DIctionary Server) l√† m·ªôt kho l∆∞u tr·ªØ c·∫•u tr√∫c d·ªØ li·ªáu trong b·ªô nh·ªõ, cho ph√©p t·∫°o ra m·ªôt Server c√≥ ch·ª©c nƒÉng d√πng b·ªô nh·ªõ ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu."
date: "2025-06-16"
image: "/vuepress-blog/images/posts/redis.png"
category: "BACK-END"
---

# Redis Basic

[1. Gi·ªõi thi·ªáu v·ªÅ Redis](#1)

[2. C√°c ki·ªÉu d·ªØ li·ªáu trong Redis](#2)

[3. C√°c c√¢u l·ªánh c∆° b·∫£n l√†m vi·ªác v·ªõi Redis](#3)

[4. Persistence trong Redis (L∆∞u tr·ªØ d·ªØ li·ªáu l√¢u d√†i)](#4)

[5. Redis Replication (Nh√¢n b·∫£n d·ªØ li·ªáu)](#5)

[6. Redis Cluster (Ph√¢n t√°n d·ªØ li·ªáu)](#6)

<a name="1"></a>

## üìå 1. Gi·ªõi thi·ªáu v·ªÅ Redis

### üîπ Redis l√† g√¨?

- Redis (REmote DIctionary Server) l√† m·ªôt kho l∆∞u tr·ªØ c·∫•u tr√∫c d·ªØ li·ªáu trong b·ªô nh·ªõ:

  - L√† m·ªôt c∆° s·ªü d·ªØ li·ªáu phi quan h·ªá.
  - L∆∞u tr·ªØ d·ªØ li·ªáu tr·ª±c ti·∫øp trong RAM thay v√¨ tr√™n ƒëƒ©a c·ª©ng hay SSD.

- Redis cho ph√©p t·∫°o ra m·ªôt Server c√≥ ch·ª©c nƒÉng d√πng b·ªô nh·ªõ ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu.

### üîπ Redis l∆∞u tr·ªØ d·ªØ li·ªáu nh∆∞ th·∫ø n√†o?

- D·ªØ li·ªáu l∆∞u tr·ªØ ·ªü d·∫°ng c·∫∑p key/value, v·ªõi gi√° tr·ªã l∆∞u tr·ªØ l√† c√°c chu·ªói, danh s√°ch, t·∫≠p h·ª£p

- M·∫∑c ƒë·ªãnh Server Redis l·∫Øng nghe ·ªü c·ªïng 6379, c√≥ nhi·ªÅu th∆∞ vi·ªán h·ªó tr·ª£ k·∫øt n·ªëi cho c√°c ng√¥n ng·ªØ nh∆∞ PHP, C#, Java ‚Ä¶

### üîπ T·∫°i sao n√™n d√πng Redis?

‚úîÔ∏è T·ªëc ƒë·ªô cao: V√¨ d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr·ªØ trong RAM, Redis c√≥ t·ªëc ƒë·ªô truy xu·∫•t c·ª±c k·ª≥ nhanh, th∆∞·ªùng ƒë·∫°t ƒë·∫øn h√†ng trƒÉm ngh√¨n ƒë·∫øn h√†ng tri·ªáu thao t√°c m·ªói gi√¢y.

‚úîÔ∏è ƒêa d·∫°ng c·∫•u tr√∫c d·ªØ li·ªáu: Redis h·ªó tr·ª£ nhi·ªÅu lo·∫°i c·∫•u tr√∫c d·ªØ li·ªáu nh∆∞ strings, lists, sets, sorted sets, hashes

‚úîÔ∏è Persistence: Redis cung c·∫•p c√°c c∆° ch·∫ø ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu xu·ªëng ƒëƒ©a (snapshotting v√† append-only file), ƒë·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã m·∫•t khi server b·ªã t·∫Øt.

‚úîÔ∏è T√≠nh s·∫µn s√†ng cao v√† d·ªÖ m·ªü r·ªông.

### üîπ ·ª®ng d·ª•ng c·ªßa Redis

V·ªõi ∆∞u ƒëi·ªÉm l√† t·ªëc ƒë·ªô, an to√†n (c√≥ c∆° ch·∫ø x√°c th·ª±c) n√™n Redis ƒë∆∞·ª£c ·ª©ng d·ª•ng trong Caching.

### üîπ C√†i ƒë·∫∑t Redis

ƒê·ªÉ c√†i ƒë·∫∑t Redis, ch√∫ng ta truy c·∫≠p [redis.io](https://redis.io/download/) v√† l√†m theo h∆∞·ªõng d·∫´n.

üî• **L∆∞u √Ω:**

- D√π c√≥ support cho c·∫£ Linux v√† Windows, nh∆∞ng phi√™n b·∫£n support cho Windows c√≥ t·ª´ kh√° l√¢u v√† kh√¥ng c√≤n ƒë∆∞·ª£c update.

- ƒê·ªÉ d·ªÖ cho vi·ªác th·ª±c h√†nh, c√≥ th·ªÉ download c√°c phi√™n b·∫£n c≈© ƒë·ªÉ ch·∫°y th·ª≠ v√† test tr√™n windows t·∫°i [Github - Redis](https://github.com/MicrosoftArchive/redis/releases).
  - C√°ch c√†i c√≥ th·ªÉ tham kh·∫£o [t·∫°i ƒë√¢y](https://stackjava.com/redis/huong-dan-cai-dat-redis-server-tren-windows.html).

<a name="2"></a>

## üìå 2. C√°c ki·ªÉu d·ªØ li·ªáu trong Redis

|             Ki·ªÉu d·ªØ li·ªáu              |                                            M√¥ t·∫£                                             |
| :-----------------------------------: | :------------------------------------------------------------------------------------------: |
|            String (Chu·ªói)             |         L√† ki·ªÉu d·ªØ li·ªáu ƒë∆°n gi·∫£n nh·∫•t, c√≥ th·ªÉ ch·ª©a vƒÉn b·∫£n, s·ªë nguy√™n, ho·∫∑c s·ªë th·ª±c          |
|           List (Danh s√°ch)            |                   Danh s√°ch c√≥ th·ª© t·ª±, h·ªó tr·ª£ th√™m/x√≥a ph·∫ßn t·ª≠ t·ª´ hai ƒë·∫ßu                    |
|             Set (T·∫≠p h·ª£p)             |                  M·ªôt t·∫≠p h·ª£p kh√¥ng c√≥ th·ª© t·ª±, kh√¥ng ch·ª©a ph·∫ßn t·ª≠ tr√πng l·∫∑p                   |
|              Sorted Set               |                Gi·ªëng Set nh∆∞ng m·ªói ph·∫ßn t·ª≠ c√≥ m·ªôt ƒëi·ªÉm s·ªë (score) ƒë·ªÉ s·∫Øp x·∫øp                 |
|              Hash (BƒÉm)               |                      L∆∞u tr·ªØ d·ªØ li·ªáu d·∫°ng key-value trong m·ªôt key cha.                       |
|       Bitmap (D·ªØ li·ªáu nh·ªã ph√¢n)       | L∆∞u tr·ªØ bit (0/1), ph√π h·ª£p ƒë·ªÉ theo d√µi tr·∫°ng th√°i theo th·ªùi gian (v√≠ d·ª•: check-in m·ªói ng√†y). |
| HyperLogLog (ƒê·∫øm ph·∫ßn t·ª≠ kh√¥ng tr√πng) |             ∆Ø·ªõc l∆∞·ª£ng s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ duy nh·∫•t m√† kh√¥ng c·∫ßn l∆∞u to√†n b·ªô d·ªØ li·ªáu             |

<a name="3"></a>

## üìå 3. C√°c c√¢u l·ªánh c∆° b·∫£n l√†m vi·ªác v·ªõi Redis

### üîπ K·∫øt n·ªëi v·ªõi Redis

Tr∆∞·ªõc khi ch·∫°y c√°c l·ªánh Redis, ch√∫ng ta c·∫ßn k·∫øt n·ªëi ƒë·∫øn Redis Server.

D∆∞·ªõi ƒë√¢y l√† c√°ch k·∫øt n·ªëi Redis theo t·ª´ng m√¥i tr∆∞·ªùng:

- Kh·ªüi ƒë·ªông Redis Server:

  ```sh
  # Ch·∫°y Redis tr√™n m√°y c·ª•c b·ªô (Local)
  redis-server

  # Ch·∫°y Redis v·ªõi Docker
  docker run --name my-redis -d -p 6379:6379 redis

  # K·∫øt n·ªëi Redis ƒë√£ ch·∫°y v·ªõi Docker
  redis-cli -h localhost -p 6379
  ```

- K·∫øt n·ªëi ƒë·∫øn Redis:

  ```sh
  # K·∫øt n·ªëi Redis ƒëang ch·∫°y tr√™n m√°y c·ª•c b·ªô
  redis-cli

  # K·∫øt n·ªëi Redis Server t·ª´ xa
  redis-cli -h 192.168.1.100 -p 6379

  # N·∫øu Redis c√≥ m·∫≠t kh·∫©u
  redis-cli -h 192.168.1.100 -p 6379 -a yourpassword
  ```

### üîπ C√°c c√¢u l·ªánh chung

|        L·ªánh        |                        M√¥ t·∫£                         |
| :----------------: | :--------------------------------------------------: |
|        PING        |        Ki·ªÉm tra xem Redis c√≥ ƒëang ch·∫°y kh√¥ng         |
|    SELECT index    | Ch·ªçn database (Redis c√≥ 16 DB m·∫∑c ƒë·ªãnh, t·ª´ 0 ƒë·∫øn 15) |
|      FLUSHDB       |     X√≥a to√†n b·ªô d·ªØ li·ªáu trong database hi·ªán t·∫°i      |
|      FLUSHALL      |      X√≥a to√†n b·ªô d·ªØ li·ªáu trong t·∫•t c·∫£ databases      |
|     EXISTS key     |   Ki·ªÉm tra key c√≥ t·ªìn t·∫°i kh√¥ng (1: c√≥, 0: kh√¥ng)    |
|      DEL key       |                       X√≥a key                        |
| EXPIRE key seconds |     ƒê·∫∑t th·ªùi gian s·ªëng cho key (t√≠nh b·∫±ng gi√¢y)      |
|      TTL key       |       Ki·ªÉm tra th·ªùi gian s·ªëng c√≤n l·∫°i c·ªßa key        |
|    PERSIST key     |      X√≥a th·ªùi gian s·ªëng c·ªßa key, gi·ªØ vƒ©nh vi·ªÖn       |
|      KEYS \*       |              L·∫•y t·∫•t c·∫£ c√°c key hi·ªán c√≥              |

üìù V√≠ d·ª•:

```sh
SET user "Alice"
EXISTS user    # K·∫øt qu·∫£: 1
DEL user
EXISTS user    # K·∫øt qu·∫£: 0
```

### üîπ C√°c c√¢u l·ªánh l√†m vi·ªác v·ªõi String

|             L·ªánh             |               M√¥ t·∫£                |
| :--------------------------: | :--------------------------------: |
|        SET key value         |        G√°n gi√° tr·ªã cho key         |
|           GET key            |        L·∫•y gi√° tr·ªã c·ªßa key         |
|           INCR key           |   TƒÉng gi√° tr·ªã s·ªë c·ªßa key l√™n 1    |
|           DECR key           |  Gi·∫£m gi√° tr·ªã s·ªë c·ªßa key xu·ªëng 1   |
|       INCRBY key value       |   TƒÉng gi√° tr·ªã c·ªßa key l√™n value   |
|       DECRBY key value       |  Gi·∫£m gi√° tr·ªã c·ªßa key xu·ªëng value  |
| MSET key1 value1 key2 value2 |   G√°n nhi·ªÅu key-value c√πng l√∫c 1   |
|        MGET key1 key2        | L·∫•y gi√° tr·ªã c·ªßa nhi·ªÅu key c√πng l√∫c |
|       APPEND key value       |      N·ªëi th√™m d·ªØ li·ªáu v√†o key      |

üìù V√≠ d·ª•:

```sh
SET counter 10
INCR counter   # K·∫øt qu·∫£: 11
INCRBY counter 5  # K·∫øt qu·∫£: 16
DECR counter   # K·∫øt qu·∫£: 15
GET counter    # K·∫øt qu·∫£: "15"
```

### üîπ C√°c c√¢u l·ªánh l√†m vi·ªác v·ªõi Hash (B·∫£ng bƒÉm)

|                 L·ªánh                  |                 M√¥ t·∫£                 |
| :-----------------------------------: | :-----------------------------------: |
|         HSET key field value          | G√°n gi√° tr·ªã v√†o m·ªôt field trong hash  |
|            HGET key field             |         L·∫•y gi√° tr·ªã c·ªßa field         |
|              HGETALL key              | L·∫•y to√†n b·ªô field v√† value trong hash |
|            HDEL key field             |         X√≥a field trong hash          |
|               HLEN key                |     ƒê·∫øm s·ªë l∆∞·ª£ng field trong hash     |
|           HEXISTS key field           |    Ki·ªÉm tra field c√≥ t·ªìn t·∫°i kh√¥ng    |
| HMSET key field1 value1 field2 value2 |      G√°n nhi·ªÅu field trong hash       |
|        HMGET key field1 field2        |       L·∫•y nhi·ªÅu field c√πng l√∫c        |

üìù V√≠ d·ª•:

```sh
HSET user:1 name "Alice"
HSET user:1 age 25
HGET user:1 name   # K·∫øt qu·∫£: "Alice"
HGETALL user:1     # K·∫øt qu·∫£: {"name": "Alice", "age": "25"}
```

### üîπ C√°c c√¢u l·ªánh l√†m vi·ªác v·ªõi List

|         L·ªánh          |                   M√¥ t·∫£                   |
| :-------------------: | :---------------------------------------: |
|    LPUSH key value    |      Th√™m ph·∫ßn t·ª≠ v√†o ƒë·∫ßu danh s√°ch       |
|    RPUSH key value    |      Th√™m ph·∫ßn t·ª≠ v√†o cu·ªëi danh s√°ch      |
|       LPOP key        |     L·∫•y v√† x√≥a ph·∫ßn t·ª≠ ƒë·∫ßu danh s√°ch      |
|       RPOP key        |     L·∫•y v√† x√≥a ph·∫ßn t·ª≠ cu·ªëi danh s√°ch     |
|       LLEN key        |      ƒê·∫øm s·ªë ph·∫ßn t·ª≠ trong danh s√°ch       |
| LRANGE key start stop | L·∫•y danh s√°ch trong kho·∫£ng (ch·ªâ m·ª•c t·ª´ 0) |
| LREM key count value  |    X√≥a count ph·∫ßn t·ª≠ c√≥ gi√° tr·ªã value     |

üìù V√≠ d·ª•:

```sh
LPUSH queue "Task1"
LPUSH queue "Task2"
RPUSH queue "Task3"
LRANGE queue 0 -1  # K·∫øt qu·∫£: ["Task2", "Task1", "Task3"]
LPOP queue  # K·∫øt qu·∫£: "Task2"
```

### üîπ C√°c c√¢u l·ªánh l√†m vi·ªác v·ªõi List

|        L·ªánh         |               M√¥ t·∫£               |
| :-----------------: | :-------------------------------: |
|   SADD key value    |       Th√™m ph·∫ßn t·ª≠ v√†o set        |
|   SREM key value    |       X√≥a ph·∫ßn t·ª≠ kh·ªèi set        |
|    SMEMBERS key     |   L·∫•y t·∫•t c·∫£ ph·∫ßn t·ª≠ trong set    |
| SISMEMBER key value | Ki·ªÉm tra ph·∫ßn t·ª≠ c√≥ t·ªìn t·∫°i kh√¥ng |
|      SCARD key      |  ƒê·∫øm s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ trong set   |
|  SUNION key1 key2   |            H·ª£p hai set            |
|  SINTER key1 key2   |   L·∫•y ph·∫ßn t·ª≠ chung c·ªßa hai set   |

üìù V√≠ d·ª•:

```sh
SADD fruits "Apple" "Banana"
SADD fruits "Orange"
SMEMBERS fruits  # K·∫øt qu·∫£: {"Apple", "Banana", "Orange"}
SISMEMBER fruits "Banana"  # K·∫øt qu·∫£: 1 (true)
```

<a name="4"></a>

## üìå 4. Persistence trong Redis

- M·∫∑c d√π Redis l√† m·ªôt in-memory database (c∆° s·ªü d·ªØ li·ªáu l∆∞u tr·ªØ trong b·ªô nh·ªõ RAM), nh∆∞ng n√≥ v·∫´n cung c·∫•p c√°c c∆° ch·∫ø persistence ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã m·∫•t khi server g·∫∑p s·ª± c·ªë ho·∫∑c kh·ªüi ƒë·ªông l·∫°i.

- Redis h·ªó tr·ª£ hai ph∆∞∆°ng ph√°p l∆∞u tr·ªØ ch√≠nh:

  - RDB (Redis Database Backup) - L∆∞u tr·ªØ theo th·ªùi ƒëi·ªÉm (Snapshot)
  - AOF (Append-Only File) - Ghi log t·ª´ng thao t√°c

  üî• Redis c≈©ng c√≥ th·ªÉ k·∫øt h·ª£p c·∫£ hai ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu an to√†n h∆°n.

### üîπ RDB (Redis Database Snapshot)

RDB l∆∞u tr·ªØ to√†n b·ªô d·ªØ li·ªáu c·ªßa Redis v√†o m·ªôt file .rdb theo t·ª´ng kho·∫£ng th·ªùi gian.

Khi Redis kh·ªüi ƒë·ªông l·∫°i, n√≥ s·∫Ω load d·ªØ li·ªáu t·ª´ file .rdb.

‚úîÔ∏è ∆Øu ƒëi·ªÉm:

- T·ªëc ƒë·ªô l∆∞u tr·ªØ nhanh v√¨ n√≥ ghi theo ki·ªÉu snapshot.
- File .rdb g·ªçn nh·∫π, d·ªÖ sao l∆∞u.

‚ùå Nh∆∞·ª£c ƒëi·ªÉm:

- C√≥ th·ªÉ m·∫•t d·ªØ li·ªáu gi·ªØa c√°c l·∫ßn snapshot.
- Ghi file .rdb t·ªën t√†i nguy√™n n·∫øu d·ªØ li·ªáu l·ªõn.

üöÄ C√°ch b·∫≠t RDB:

RDB ƒë∆∞·ª£c k√≠ch ho·∫°t m·∫∑c ƒë·ªãnh trong redis.conf:

```sh
save 900 1   # L∆∞u sau 900 gi√¢y n·∫øu c√≥ √≠t nh·∫•t 1 thay ƒë·ªïi
save 300 10  # L∆∞u sau 300 gi√¢y n·∫øu c√≥ √≠t nh·∫•t 10 thay ƒë·ªïi
save 60 10000 # L∆∞u sau 60 gi√¢y n·∫øu c√≥ √≠t nh·∫•t 10000 thay ƒë·ªïi
```

Ho·∫∑c l∆∞u ngay b·∫±ng l·ªánh:

```sh
BGSAVE
```

File .rdb m·∫∑c ƒë·ªãnh ƒë∆∞·ª£c l∆∞u t·∫°i:

```sh
/var/lib/redis/dump.rdb
```

### üîπ AOF (Append Only File)

AOF ghi l·∫°i to√†n b·ªô l·ªánh thay ƒë·ªïi d·ªØ li·ªáu c·ªßa Redis v√†o file log (appendonly.aof).

Khi Redis restart, n√≥ s·∫Ω ch·∫°y l·∫°i c√°c l·ªánh n√†y ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu.

‚úîÔ∏è ∆Øu ƒëi·ªÉm:

- ƒê·∫£m b·∫£o kh√¥ng m·∫•t d·ªØ li·ªáu.
- Ghi log theo t·ª´ng l·ªánh n√™n c√≥ th·ªÉ kh√¥i ph·ª•c chi ti·∫øt.

‚ùå Nh∆∞·ª£c ƒëi·ªÉm:

- File AOF l·ªõn h∆°n RDB v√¨ ghi t·ª´ng l·ªánh.
- C·∫ßn t·ªëi ∆∞u h√≥a (AOF rewrite) ƒë·ªÉ tr√°nh file qu√° l·ªõn.

üöÄ C√°ch b·∫≠t AOF:

B·∫≠t AOF trong redis.conf:

```sh
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec # Ghi v√†o disk m·ªói gi√¢y (c√¢n b·∫±ng hi·ªáu su·∫•t v√† an to√†n)
```

Ho·∫∑c b·∫≠t AOF ngay b·∫±ng l·ªánh:

```sh
CONFIG SET appendonly yes
```

### üîπ Hybrid Mode (K·∫øt h·ª£p RDB + AOF)

Redis cho ph√©p d√πng c·∫£ RDB & AOF c√πng l√∫c ƒë·ªÉ t·∫≠n d·ª•ng ∆∞u ƒëi·ªÉm c·ªßa c·∫£ hai.

üöÄ C√°ch b·∫≠t Hybrid:

```sh
aof-use-rdb-preamble yes
```

L√∫c n√†y, Redis s·∫Ω ghi ƒë√® AOF b·∫±ng snapshot .rdb ƒë·ªÉ t·ªëi ∆∞u dung l∆∞·ª£ng.

<a name="5"></a>

## üìå 5. Redis Replication (Nh√¢n b·∫£n d·ªØ li·ªáu)

Replication gi√∫p Redis t·∫°o nhi·ªÅu b·∫£n sao (slave) c·ªßa master, gi√∫p ƒë·∫°t ƒë∆∞·ª£c t√≠nh s·∫µn s√†ng cao:

- Load balancing (chia t·∫£i).
- Backup d·ªØ li·ªáu ph√≤ng tr∆∞·ªùng h·ª£p master b·ªã l·ªói.
- H·ªó tr·ª£ failover t·ª± ƒë·ªông.

### üîπ C·∫•u h√¨nh Master-Slave

M·∫∑c ƒë·ªãnh, Redis ch·ªâ c√≥ m·ªôt Master, nh∆∞ng c√≥ th·ªÉ th√™m nhi·ªÅu Slave.

- C·∫•u h√¨nh Slave:

  ```sh
  SLAVEOF <master-ip> <master-port>

  # V√≠ d·ª• master ch·∫°y ·ªü 192.168.1.100:6379
  SLAVEOF 192.168.1.100 6379
  ```

  ho·∫∑c th√™m v√†o redis.conf:

  ```sh
  replicaof 192.168.1.100 6379
  ```

- Ki·ªÉm tra Replication:

  ```sh
  # Tr√™n Master, ki·ªÉm tra c√°c Slave b·∫±ng l·ªánh:
  INFO replication
  ```

  K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã c√°c Slave k·∫øt n·ªëi ƒë·∫øn Master.

### üîπ C·∫•u h√¨nh Redis Sentinel (Failover t·ª± ƒë·ªông)

Sentinel gi√∫p t·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi Master-Slave khi Master b·ªã l·ªói.

- C·∫•u h√¨nh Sentinel:

  T·∫°o file sentinel.conf:

  ```sh
  sentinel monitor mymaster 192.168.1.100 6379 2
  sentinel down-after-milliseconds mymaster 5000
  sentinel failover-timeout mymaster 60000
  sentinel parallel-syncs mymaster 1
  ```

  Ch·∫°y Sentinel:

  ```sh
  redis-sentinel sentinel.conf
  ```

  Khi Master b·ªã l·ªói, Sentinel s·∫Ω t·ª± ƒë·ªông chuy·ªÉn m·ªôt Slave th√†nh Master.

<a name="6"></a>

## üìå 6. Redis Cluster (Ph√¢n t√°n d·ªØ li·ªáu)

Redis kh√¥ng ch·ªâ h·ªó tr·ª£ Persistence (L∆∞u tr·ªØ d·ªØ li·ªáu l√¢u d√†i) v√† Replication (Nh√¢n b·∫£n d·ªØ li·ªáu) m√† c√≤n c√≥ Cluster (Ph√¢n t√°n d·ªØ li·ªáu) ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t cao v√† m·ªü r·ªông quy m√¥.

Redis Cluster gi√∫p chia d·ªØ li·ªáu th√†nh nhi·ªÅu node, gi√∫p:

- Chia t·∫£i ƒë·ªÉ tƒÉng hi·ªáu su·∫•t.
- Tr√°nh single point of failure (SPoF).
- H·ªó tr·ª£ m·ªü r·ªông d·ªÖ d√†ng.

### üîπ C√°ch Redis Cluster ho·∫°t ƒë·ªông

Redis s·ª≠ d·ª•ng "slots" thay v√¨ key-value ƒë∆°n thu·∫ßn

- **Sharding (Chia d·ªØ li·ªáu)**:

  - Redis chia d·ªØ li·ªáu th√†nh 16384 hash slot (t∆∞∆°ng ƒë∆∞∆°ng 16,384 ph·∫ßn d·ªØ li·ªáu).
  - M·ªói key khi l∆∞u v√†o Redis s·∫Ω ƒë∆∞·ª£c bƒÉm (hash) ƒë·ªÉ x√°c ƒë·ªãnh n√≥ thu·ªôc slot n√†o.
  - M·ªói node trong cluster s·∫Ω ch·ªãu tr√°ch nhi·ªám l∆∞u m·ªôt t·∫≠p h·ª£p c√°c slots.
  - V√≠ d·ª• v·ªõi 3 node:
    - Node A l∆∞u d·ªØ li·ªáu t·ª´ slot 0 ‚Äì 5500.
    - Node B l∆∞u d·ªØ li·ªáu t·ª´ slot 5501 ‚Äì 11000.
    - Node C l∆∞u d·ªØ li·ªáu t·ª´ slot 11001 ‚Äì 16383.

- **Multiple Masters**: Redis Cluster c√≥ nhi·ªÅu master, m·ªói master qu·∫£n l√Ω m·ªôt ph·∫ßn slot.

- **Automatic Failover**: N·∫øu m·ªôt master b·ªã l·ªói, slave c·ªßa n√≥ s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c n√¢ng l√™n l√†m master.

V√≠ d·ª• Redis Cluster 6 node:

```
[ Master 1 ] <--> [ Master 2 ] <--> [ Master 3 ]
    |                 |                 |
[ Slave 1 ]       [ Slave 2 ]       [ Slave 3 ]
```

üëâ Master ch·ª©a d·ªØ li·ªáu ch√≠nh, Slave h·ªó tr·ª£ d·ª± ph√≤ng.

üí° N·∫øu Master 2 b·ªã l·ªói, Slave 2 t·ª± ƒë·ªông thƒÉng c·∫•p th√†nh Master m·ªõi

### üîπ C·∫•u h√¨nh Redis Cluster

ƒê·ªÉ t·∫°o Redis Cluster, c·∫ßn √≠t nh·∫•t 3 master + 3 slave (t·ªïng 6 node).

- **B∆∞·ªõc 1**: Ch·∫°y nhi·ªÅu Redis instance

  Gi·∫£ s·ª≠ b·∫°n c√≥ 6 Redis node tr√™n 3 server:

  |  Node   |      IP       | Port |
  | :-----: | :-----------: | :--: |
  | redis-1 | 192.168.1.101 | 7001 |
  | redis-2 | 192.168.1.102 | 7002 |
  | redis-3 | 192.168.1.103 | 7003 |
  | redis-4 | 192.168.1.101 | 7004 |
  | redis-5 | 192.168.1.102 | 7005 |
  | redis-6 | 192.168.1.103 | 7006 |

  Ch·∫°y Redis v·ªõi c·∫•u h√¨nh sau (v√≠ d·ª• redis-1.conf):

  ```sh
  port 7001
  cluster-enabled yes    # B·∫≠t ch·∫ø ƒë·ªô cluster
  cluster-config-file nodes-7001.conf    # L∆∞u th√¥ng tin cluster
  cluster-node-timeout 5000    # Timeout cho cluster (5 gi√¢y)
  appendonly yes    # B·∫≠t persistence (AOF)
  ```

  T∆∞∆°ng t·ª±, t·∫°o file config cho c√°c node c√≤n l·∫°i (redis-2.conf, redis-3.conf...).

  Kh·ªüi ƒë·ªông c√°c Redis instance:

  ```sh
  redis-server redis-1.conf
  redis-server redis-2.conf
  ...
  ```

- **B∆∞·ªõc 2**: T·∫°o Cluster

  ```sh
  redis-cli --cluster create 192.168.1.101:7001 192.168.1.102:7002 192.168.1.103:7003 192.168.1.101:7004 192.168.1.102:7005 192.168.1.103:7006 --cluster-replicas 1
  ```

  --cluster-replicas 1: M·ªói master s·∫Ω c√≥ 1 slave.

  Redis s·∫Ω t·ª± ƒë·ªông ph√¢n chia slot v√† c·∫•u h√¨nh master/slave.

### üîπ Ki·ªÉm tra Cluster

```sh
# Xem tr·∫°ng th√°i cluster
redis-cli -c -p 7001 cluster info

# Xem danh s√°ch node
redis-cli -c -p 7001 cluster nodes

# Th·ª≠ set/get key
redis-cli -c -p 7001 set mykey "Hello Redis Cluster"
redis-cli -c -p 7002 get mykey
```

### üîπ Auto Failover

Khi m·ªôt master b·ªã l·ªói, Redis Cluster s·∫Ω t·ª± ƒë·ªông n√¢ng c·∫•p m·ªôt slave th√†nh master.

M√¥ ph·ªèng l·ªói b·∫±ng c√°ch d·ª´ng redis-1:

```sh
# D·ª´ng redis-1
redis-cli -c -p 7001 shutdown

# Sau ƒë√≥, ki·ªÉm tra cluster
redis-cli -c -p 7002 cluster nodes
```

B·∫°n s·∫Ω th·∫•y m·ªôt slave ƒë√£ tr·ªü th√†nh master.

### üîπ So s√°nh Replication vs Cluster

|         T√≠nh nƒÉng         |      Replication       |          Cluster           |
| :-----------------------: | :--------------------: | :------------------------: |
|          S·ªë node          | 1 master + nhi·ªÅu slave | Nhi·ªÅu master + nhi·ªÅu slave |
|      TƒÉng t·ªëc ƒë·ªô ƒë·ªçc      |         ‚úîÔ∏è C√≥          |           ‚úîÔ∏è C√≥            |
|      TƒÉng t·ªëc ƒë·ªô ghi      |        ‚ùå Kh√¥ng        |           ‚úîÔ∏è C√≥            |
|     T·ª± ƒë·ªông failover      |         ‚úîÔ∏è C√≥          |           ‚úîÔ∏è C√≥            |
|     Chia nh·ªè d·ªØ li·ªáu      |        ‚ùå Kh√¥ng        |      ‚úîÔ∏è C√≥ (Sharding)      |
| M·ªü r·ªông ngang (Scale-out) |        ‚ùå Kh√¥ng        |           ‚úîÔ∏è C√≥            |
